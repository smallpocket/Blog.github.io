<!DOCTYPE html>





<html class="theme-next gemini use-motion" lang="">
<head>
  <meta charset="UTF-8">
<meta name="generator" content="Hexo 3.9.0">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.2.0">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.2.0">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.2.0">
  <link rel="mask-icon" href="/images/logo.svg?v=7.2.0" color="#222">

<link rel="stylesheet" href="/css/main.css?v=7.2.0">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.7.0">


<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '7.2.0',
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    copycode: {"enable":false,"show_result":false,"style":null},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    algolia: {
      applicationID: 'OZTK1BY156',
      apiKey: '',
      indexName: 'BlogIndex',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    search: {
      root: '/',
      path: ''
    },
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    translation: {
      copy_button: 'Kopieren',
      copy_success: 'Kopiert',
      copy_failure: 'Kopieren fehlgeschlagen'
    }
  };
</script>

  <meta name="description" content="To be awesome">
<meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://yoursite.com/page/5/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="To be awesome">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Hexo">
<meta name="twitter:description" content="To be awesome">
  <link rel="canonical" href="http://yoursite.com/page/5/">


<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>Hexo</title>
  








  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="default">

  <div class="container sidebar-position-left page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Hexo</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Navigationsleiste an/ausschalten">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
    <ul id="menu" class="menu">
        
        
        
          
          <li class="menu-item menu-item-home">
      
    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>Startseite</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-about">
      
    

    <a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i> <br>Über</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">
      
    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>Schlagwörter</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">
      
    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>Kategorien</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">
      
    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>Archiv</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-schedule">
      
    

    <a href="/schedule/" rel="section"><i class="menu-item-icon fa fa-fw fa-calendar"></i> <br>Zeitplan</a>

  </li>
        <li class="menu-item menu-item-search">
          <a href="javascript:;" class="popup-trigger">
          
            <i class="menu-item-icon fa fa-search fa-fw"></i> <br>Suche</a>
        </li>
      
    </ul>
    <div class="site-search">
      
  <div class="algolia-popup popup search-popup">
  <div class="algolia-search">
    <div class="algolia-search-input-icon">
      <i class="fa fa-search"></i>
    </div>
    <div class="algolia-search-input" id="algolia-search-input"></div>
  </div>

  <div class="algolia-results">
    <div id="algolia-stats"></div>
    <div id="algolia-hits"></div>
    <div id="algolia-pagination" class="algolia-pagination"></div>
  </div>

  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>



    </div>
</nav>

</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
            

          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
      

  <article class="post post-type-tags" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/07/08/版本控制/Git：命令/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Heper">
      <meta itemprop="description" content="To be awesome">
      <meta itemprop="image" content="/images/head.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">

        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/07/08/版本控制/Git：命令/" class="post-title-link" itemprop="url">Git：命令</a>
              
            
          </h1>
        

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              

              
                
              

              <time title="Erstellt: 2019-07-08 09:16:29" itemprop="dateCreated datePublished" datetime="2019-07-08T09:16:29+08:00">2019-07-08</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Bearbeitet am</span>
                
                <time title="Geändert am: 2019-07-29 09:23:47" itemprop="dateModified" datetime="2019-07-29T09:23:47+08:00">2019-07-29</time>
              </span>
            
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">in</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/版本控制/" itemprop="url" rel="index"><span itemprop="name">版本控制</span></a></span>

                
                
              
            </span>
          

          
            <span id="/2019/07/08/版本控制/Git：命令/" class="post-meta-item leancloud_visitors" data-flag-title="Git：命令">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">Aufrufe: </span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          
            
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="fa fa-comment-o"></i>
    </span>
    
      <span class="post-meta-item-text">Kommentare: </span>
    
  
    <a href="/2019/07/08/版本控制/Git：命令/#comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2019/07/08/版本控制/Git：命令/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
          <br>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
            <h1 id="Git-reset"><a href="#Git-reset" class="headerlink" title="Git reset"></a>Git reset</h1><p><code>git reset</code>命令用于将当前<code>HEAD</code>复位到指定状态。一般用于撤消之前的一些操作(如：<code>git add</code>,<code>git commit</code>等)。</p>
<p><strong>简介</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git reset [-q] [&lt;tree-ish&gt;] [--] &lt;paths&gt;…</span><br><span class="line">git reset (--patch | -p) [&lt;tree-ish&gt;] [--] [&lt;paths&gt;…]</span><br><span class="line">git reset [--soft | --mixed [-N] | --hard | --merge | --keep] [-q] [&lt;commit&gt;]</span><br></pre></td></tr></table></figure>

<h2 id="描述"><a href="#描述" class="headerlink" title="描述"></a>描述</h2><p>在第一和第二种形式中，将条目从<code>&lt;tree-ish&gt;</code>复制到索引。 在第三种形式中，将当前分支头(<code>HEAD</code>)设置为<code>&lt;commit&gt;</code>，可选择修改索引和工作树进行匹配。所有形式的<code>&lt;tree-ish&gt;/&lt;commit&gt;</code>默认为 <code>HEAD</code> 。</p>
<p>这里的 <code>HEAD</code> 关键字指的是当前分支最末梢最新的一个提交。也就是版本库中该分支上的最新版本。</p>
<h2 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h2><p>以下是一些示例 -</p>
<p>在git的一般使用中，如果发现错误的将不想暂存的文件被<code>git add</code>进入索引之后，想回退取消，则可以使用命令：<code>git reset HEAD &lt;file&gt;</code>，同时<code>git add</code>完毕之后，git也会做相应的提示，比如：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> Changes to be committed: </span></span><br><span class="line"><span class="meta">#</span><span class="bash">   (use <span class="string">"git reset HEAD &lt;file&gt;..."</span> to unstage) </span></span><br><span class="line"><span class="meta">#</span><span class="bash"> </span></span><br><span class="line"><span class="meta">#</span><span class="bash"> new file:   test.py</span></span><br></pre></td></tr></table></figure>

<p><code>git reset [--hard|soft|mixed|merge|keep] [&lt;commit&gt;或HEAD]</code>：将当前的分支重设(<code>reset</code>)到指定的<code>&lt;commit&gt;</code>或者<code>HEAD</code>(默认，如果不显示指定<code>&lt;commit&gt;</code>，默认是<code>HEAD</code>，即最新的一次提交)，并且根据<code>[mode]</code>有可能更新索引和工作目录。<code>mode</code>的取值可以是<code>hard</code>、<code>soft</code>、<code>mixed</code>、<code>merged</code>、<code>keep</code>。下面来详细说明每种模式的意义和效果。</p>
<p>A). <code>--hard</code>：重设(reset) 索引和工作目录，自从<code>&lt;commit&gt;</code>以来在工作目录中的任何改变都被丢弃，并把HEAD指向<code>&lt;commit&gt;</code>。 </p>
<p>下面是具体一个例子，假设有三个commit， 执行 <code>git status</code>结果如下:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">commit3: add test3.c</span><br><span class="line">commit2: add test2.c</span><br><span class="line">commit1: add test1.c</span><br></pre></td></tr></table></figure>

<p>执行<code>git reset --hard HEAD~1</code>命令后，<br>显示：<code>HEAD is now at commit2</code>，运行<code>git log</code>，如下所示 - </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">commit2: add test2.c</span><br><span class="line">commit1: add test1.c</span><br></pre></td></tr></table></figure>

<h2 id="应用场景"><a href="#应用场景" class="headerlink" title="应用场景"></a>应用场景</h2><p>下面列出一些git reset的典型的应用场景： </p>
<p><strong>(A) 回滚添加操作</strong> </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> edit    file1.c file2.c           <span class="comment"># (1) </span></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git add file1.c file1.c           <span class="comment"># (1.1) 添加两个文件到暂存</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> mailx                             <span class="comment">#  (2) </span></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git reset                           <span class="comment"># (3) </span></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git pull git://info.example.com/ nitfol    <span class="comment"># (4)</span></span></span><br></pre></td></tr></table></figure>

<p>(1). 编辑文件 <code>file1.c</code>, <code>file2.c</code>，做了些更改，并把更改添加到了暂存区。<br>(2). 查看邮件，发现某人要您执行<code>git pull</code>，有一些改变需要合并下来。<br>(3). 然而，您已经把暂存区搞乱了，因为暂存区同HEAD commit不匹配了，但是即将<code>git pull</code>下来的东西不会影响已经修改的<code>file1.c</code> 和 <code>file2.c</code>，因此可以<code>revert</code>这两个文件的改变。在revert后，那些改变应该依旧在工作目录中，因此执行<code>git reset</code>。<br>(4). 然后，执行了<code>git pull</code>之后，自动合并，<code>file1.c</code> 和 <code>file2.c</code>这些改变依然在工作目录中。 </p>
<p><strong>(B)回滚最近一次提交</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git commit -a -m <span class="string">"这是提交的备注信息"</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git reset --soft HEAD^      <span class="comment">#(1) </span></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> edit code                        <span class="comment">#(2) 编辑代码操作</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git commit -a -c ORIG_HEAD  <span class="comment">#(3)</span></span></span><br></pre></td></tr></table></figure>

<p>(1) 当提交了之后，又发现代码没有提交完整，或者想重新编辑一下提交的信息，可执行<code>git reset --soft HEAD^</code>，让工作目录还跟<code>reset</code>之前一样，不作任何改变。<br><code>HEAD^</code>表示指向<code>HEAD</code>之前最近的一次提交。<br>(2) 对工作目录下的文件做修改，比如：修改文件中的代码等。<br>(3) 然后使用<code>reset</code>之前那次提交的注释、作者、日期等信息重新提交。注意，当执行<code>git reset</code>命令时，git会把老的HEAD拷贝到文件<code>.git/ORIG_HEAD</code>中，在命令中可以使用ORIG_HEAD引用这个提交。<code>git commit</code> 命令中 <code>-a</code>参数的意思是告诉git，自动把所有修改的和删除的文件都放进暂存区，未被git跟踪的新建的文件不受影响。<code>commit</code>命令中<code>-c &lt;commit&gt;</code> 或者 <code>-C &lt;commit&gt;</code>意思是拿已经提交的对象中的信息(作者，提交者，注释，时间戳等)提交，那么这条<code>git commit</code> 命令的意思就非常清晰了，把所有更改的文件加入暂存区，并使用上次的提交信息重新提交。 </p>
<p><strong>(C) 回滚最近几次提交，并把这几次提交放到指定分支中</strong></p>
<p>回滚最近几次提交，并把这几次提交放到叫做<code>topic/wip</code>的分支上去。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git branch topic/wip     (1) </span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git reset --hard HEAD~3  (2) </span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git checkout topic/wip   (3)</span></span><br></pre></td></tr></table></figure>

<p>(1) 假设已经提交了一些代码，但是此时发现这些提交还不够成熟，不能进入<code>master</code>分支，希望在新的<code>branch</code>上暂存这些改动。因此执行了<code>git branch</code>命令在当前的HEAD上建立了新的叫做 <code>topic/wip</code> 的分支。<br>(2) 然后回滚<code>master</code>分支上的最近三次提交。<code>HEAD~3</code>指向当前<code>HEAD-3</code>个提交，<code>git reset --hard HEAD~3</code>，即删除最近的三个提交(删除<code>HEAD</code>, <code>HEAD^</code>, <code>HEAD~2</code>)，将HEAD指向<code>HEAD~3</code>。 </p>
<p><strong>(D) 永久删除最后几个提交</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git commit <span class="comment">## 执行一些提交</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git reset --hard HEAD~3   (1)</span></span><br></pre></td></tr></table></figure>

<p>(1) 最后三个提交(即<code>HEAD</code>, <code>HEAD^</code>和<code>HEAD~2</code>)提交有问题，想永久删除这三个提交。 </p>
<p><strong>(E) 回滚merge和pull操作</strong> </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git pull                         (1) </span></span><br><span class="line">Auto-merging nitfol </span><br><span class="line">CONFLICT (content): Merge conflict in nitfol </span><br><span class="line">Automatic merge failed; fix conflicts and then commit the result. </span><br><span class="line"><span class="meta">$</span><span class="bash"> git reset --hard                 (2) </span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git pull . topic/branch          (3) </span></span><br><span class="line">Updating from 41223... to 13134... </span><br><span class="line">Fast-forward </span><br><span class="line"><span class="meta">$</span><span class="bash"> git reset --hard ORIG_HEAD       (4)</span></span><br><span class="line">`</span><br></pre></td></tr></table></figure>

<p>(1) 从<code>origin</code>拉取下来一些更新，但是产生了很多冲突，但您暂时没有这么多时间去解决这些冲突，因此决定稍候有空的时候再重新执行<code>git pull</code>操作。<br>(2) 由于<code>git pull</code>操作产生了冲突，因此所有拉取下来的改变尚未提交，仍然再暂存区中，这种情况下<code>git reset --hard</code> 与 <code>git reset --hard HEAD</code>意思相同，即都是清除索引和工作区中被搞乱的东西。<br>(3) 将<code>topic/branch</code>分支合并到当前的分支，这次没有产生冲突，并且合并后的更改自动提交。<br>(4) 但是此时又发现将<code>topic/branch</code>合并过来为时尚早，因此决定退滚合并，执行<code>git reset --hard ORIG_HEAD</code>回滚刚才的<code>pull/merge</code>操作。说明：前面讲过，执行<code>git reset</code>时，git会把<code>reset</code>之前的HEAD放入<code>.git/ORIG_HEAD</code>文件中，命令行中使用ORIG_HEAD引用这个提交。同样的，执行<code>git pull</code>和<code>git merge</code>操作时，git都会把执行操作前的HEAD放入<code>ORIG_HEAD</code>中，以防回滚操作。 </p>
<p><strong>(F) 在污染的工作区中回滚合并或者拉取</strong> </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git pull                         (1) </span></span><br><span class="line">Auto-merging nitfol </span><br><span class="line">Merge made by recursive. </span><br><span class="line">nitfol                |   20 +++++---- </span><br><span class="line">... </span><br><span class="line"><span class="meta">$</span><span class="bash"> git reset --merge ORIG_HEAD      (2)</span></span><br></pre></td></tr></table></figure>

<p>(1) 即便你已经在本地更改了工作区中的一些东西，可安全的执行<code>git pull</code>操作，前提是要知道将要<code>git pull</code>下面的内容不会覆盖工作区中的内容。<br>(2) <code>git pull</code>完后，发现这次拉取下来的修改不满意，想要回滚到<code>git pull</code>之前的状态，从前面的介绍知道，我们可以执行<code>git reset --hard ORIG_HEAD</code>，但是这个命令有个副作用就是清空工作区，即丢弃本地未使用<code>git add</code>的那些改变。为了避免丢弃工作区中的内容，可以使用<code>git reset --merge ORIG_HEAD</code>，注意其中的<code>--hard</code> 换成了 <code>--merge</code>，这样就可以避免在回滚时清除工作区。 </p>
<p><strong>(G) 中断的工作流程处理</strong> </p>
<p>在实际开发中经常出现这样的情形：你正在开发一个大的新功能(工作在分支：<code>feature</code> 中)，此时来了一个紧急的bug需要修复，但是目前在工作区中的内容还没有成型，还不足以提交，但是又必须切换的另外的分支去修改bug。请看下面的例子 - </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git checkout feature ;<span class="comment"># you were working in "feature" branch and </span></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> work work work       ;<span class="comment"># got interrupted </span></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git commit -a -m <span class="string">"snapshot WIP"</span>                 (1) </span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git checkout master </span></span><br><span class="line"><span class="meta">$</span><span class="bash"> fix fix fix </span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git commit ;<span class="comment"># commit with real log </span></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git checkout feature </span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git reset --soft HEAD^ ;<span class="comment"># go back to WIP state  (2) </span></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git reset                                       (3)</span></span><br></pre></td></tr></table></figure>

<p>(1) 这次属于临时提交，因此随便添加一个临时注释即可。<br>(2) 这次<code>reset</code>删除了WIP commit，并且把工作区设置成提交WIP快照之前的状态。<br>(3) 此时，在索引中依然遗留着“<em>snapshot WIP</em>”提交时所做的未提交变化，<code>git reset</code>将会清理索引成为尚未提交”<em>snapshot WIP</em>“时的状态便于接下来继续工作。 </p>
<p><strong>(H) 重置单独的一个文件</strong> </p>
<p>假设你已经添加了一个文件进入索引，但是而后又不打算把这个文件提交，此时可以使用<code>git reset</code>把这个文件从索引中去除。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git reset -- frotz.c                      (1) </span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git commit -m <span class="string">"Commit files in index"</span>     (2) </span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git add frotz.c                           (3)</span></span><br></pre></td></tr></table></figure>

<p>(1) 把文件<code>frotz.c</code>从索引中去除，<br>(2) 把索引中的文件提交<br>(3) 再次把<code>frotz.c</code>加入索引</p>
<p><strong>(I) 保留工作区并丢弃一些之前的提交</strong> </p>
<p>假设你正在编辑一些文件，并且已经提交，接着继续工作，但是现在你发现当前在工作区中的内容应该属于另一个分支，与之前的提交没有什么关系。此时，可以开启一个新的分支，并且保留着工作区中的内容。 </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git tag start </span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git checkout -b branch1 </span></span><br><span class="line"><span class="meta">$</span><span class="bash"> edit </span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git commit ...                            (1) </span></span><br><span class="line"><span class="meta">$</span><span class="bash"> edit </span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git checkout -b branch2                   (2) </span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git reset --keep start                    (3)</span></span><br></pre></td></tr></table></figure>

<p>(1) 这次是把在<code>branch1</code>中的改变提交了。<br>(2) 此时发现，之前的提交不属于这个分支，此时新建了<code>branch2</code>分支，并切换到了<code>branch2</code>上。<br>(3) 此时可以用<code>reset --keep</code>把在<code>start</code>之后的提交清除掉，但是保持工作区不变。</p>
<h1 id="Git-checkout"><a href="#Git-checkout" class="headerlink" title="Git checkout"></a>Git checkout</h1><p><code>git checkout</code>命令用于切换分支或恢复工作树文件。<code>git checkout</code>是git最常用的命令之一，同时也是一个很危险的命令，因为这条命令会重写工作区。</p>
<p><strong>使用语法</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">git checkout [-q] [-f] [-m] [&lt;branch&gt;]</span><br><span class="line">git checkout [-q] [-f] [-m] --detach [&lt;branch&gt;]</span><br><span class="line">git checkout [-q] [-f] [-m] [--detach] &lt;commit&gt;</span><br><span class="line">git checkout [-q] [-f] [-m] [[-b|-B|--orphan] &lt;new_branch&gt;] [&lt;start_point&gt;]</span><br><span class="line">git checkout [-f|--ours|--theirs|-m|--conflict=&lt;style&gt;] [&lt;tree-ish&gt;] [--] &lt;paths&gt;…</span><br><span class="line">git checkout [-p|--patch] [&lt;tree-ish&gt;] [--] [&lt;paths&gt;…]</span><br></pre></td></tr></table></figure>

<h2 id="描述-1"><a href="#描述-1" class="headerlink" title="描述"></a>描述</h2><p>更新工作树中的文件以匹配索引或指定树中的版本。如果没有给出路径 - <code>git checkout</code>还会更新<code>HEAD</code>，将指定的分支设置为当前分支。</p>
<h2 id="示例-1"><a href="#示例-1" class="headerlink" title="示例"></a>示例</h2><p>以下是一些示例 -</p>
<p><strong>示例-1</strong></p>
<p>以下顺序检查主分支，将<code>Makefile</code>还原为两个修订版本，错误地删除<code>hello.c</code>，并从索引中取回。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git checkout master             <span class="comment">#(1)</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git checkout master~2 Makefile  <span class="comment">#(2)</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> rm -f hello.c</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git checkout hello.c            <span class="comment">#(3)</span></span></span><br></pre></td></tr></table></figure>

<p>(1) 切换分支<br>(2) 从另一个提交中取出文件<br>(3)从索引中恢复<code>hello.c</code></p>
<p>如果想要检出索引中的所有<code>C</code>源文件，可以使用以下命令 - </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git checkout -- <span class="string">'*.c'</span></span></span><br></pre></td></tr></table></figure>

<p>注意:<code>*.c</code>是使用引号的。 文件<code>hello.c</code>也将被检出，即使它不再在工作树中，因为文件<code>globbing</code>用于匹配索引中的条目(而不是在shell的工作树中)。</p>
<p>如果有一个分支也命名为<em>hello.c</em>，这一步将被混淆为一个指令切换到该分支。应该写：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git checkout -- hello.c</span></span><br></pre></td></tr></table></figure>

<p><strong>示例-2</strong></p>
<p>在错误的分支工作后，想切换到正确的分支，则使用：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git checkout mytopic</span></span><br></pre></td></tr></table></figure>

<p>但是，您的“错误”分支和正确的“<code>mytopic</code>”分支可能会在在本地修改的文件中有所不同，在这种情况下，上述检出将会失败：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git checkout mytopic</span></span><br><span class="line">error: You have local changes to 'frotz'; not switching branches.</span><br></pre></td></tr></table></figure>

<p>可以将<code>-m</code>标志赋给命令，这将尝试三路合并：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git checkout -m mytopic</span></span><br><span class="line">Auto-merging frotz</span><br></pre></td></tr></table></figure>

<p>在这种三路合并之后，本地的修改没有在索引文件中注册，所以<code>git diff</code>会显示从新分支的提示之后所做的更改。</p>
<p><strong>示例-3</strong></p>
<p>当使用<code>-m</code>选项切换分支时发生合并冲突时，会看到如下所示：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git checkout -m mytopic</span></span><br><span class="line">Auto-merging frotz</span><br><span class="line">ERROR: Merge conflict in frotz</span><br><span class="line">fatal: merge program failed</span><br></pre></td></tr></table></figure>

<p>此时，<code>git diff</code>会显示上一个示例中干净合并的更改以及冲突文件中的更改。 编辑并解决冲突，并用常规方式用<code>git add</code>来标记它：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> edit frotz <span class="comment"># 编辑 frotz 文件中内容，然后重新添加</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git add frotz</span></span><br></pre></td></tr></table></figure>

<p><strong>其它示例</strong></p>
<p><code>git checkout</code>的主要功能就是迁出一个分支的特定版本。默认是迁出分支的HEAD版本<br>一此用法示例：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git checkout master     <span class="comment">#//取出master版本的head。</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git checkout tag_name    <span class="comment">#//在当前分支上 取出 tag_name 的版本</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git checkout  master file_name  <span class="comment">#//放弃当前对文件file_name的修改</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git checkout  commit_id file_name  <span class="comment">#//取文件file_name的 在commit_id是的版本。commit_id为 git commit 时的sha值。</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash"> git checkout -b dev/1.5.4 origin/dev/1.5.4</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 从远程dev/1.5.4分支取得到本地分支/dev/1.5.4</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git checkout -- hello.rb</span></span><br><span class="line"><span class="meta">#</span><span class="bash">这条命令把hello.rb从HEAD中签出.</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git checkout .</span></span><br><span class="line"><span class="meta">#</span><span class="bash">这条命令把 当前目录所有修改的文件 从HEAD中签出并且把它恢复成未修改时的样子.</span></span><br><span class="line"><span class="meta">#</span><span class="bash">注意：在使用 git checkout 时，如果其对应的文件被修改过，那么该修改会被覆盖掉。</span></span><br></pre></td></tr></table></figure>

<h1 id="Git-merge"><a href="#Git-merge" class="headerlink" title="Git merge"></a>Git merge</h1><p><code>git merge</code>命令用于将两个或两个以上的开发历史加入(合并)一起。</p>
<p><strong>使用语法</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">git merge [-n] [--stat] [--no-commit] [--squash] [--[no-]edit]</span><br><span class="line">    [-s &lt;strategy&gt;] [-X &lt;strategy-option&gt;] [-S[&lt;keyid&gt;]]</span><br><span class="line">    [--[no-]allow-unrelated-histories]</span><br><span class="line">    [--[no-]rerere-autoupdate] [-m &lt;msg&gt;] [&lt;commit&gt;…]</span><br><span class="line">git merge --abort</span><br><span class="line">git merge --continue</span><br></pre></td></tr></table></figure>

<h2 id="描述-2"><a href="#描述-2" class="headerlink" title="描述"></a>描述</h2><p>将来自命名提交的更改(从其历史从当前分支转移到当前分支之后)。 该命令由<code>git pull</code>用于合并来自另一个存储库的更改，可以手动使用将更改从一个分支合并到另一个分支。</p>
<h2 id="示例-2"><a href="#示例-2" class="headerlink" title="示例"></a>示例</h2><p>以下是一些示例 -</p>
<p><strong>示例-1</strong></p>
<p>合并分支<code>fixes</code>和<code>enhancements</code>在当前分支的顶部，使它们合并：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git merge fixes enhancements</span></span><br></pre></td></tr></table></figure>

<p><strong>示例-2</strong></p>
<p>合并<code>obsolete</code>分支到当前分支，使用<code>ours</code>合并策略：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git merge -s ours obsolete</span></span><br></pre></td></tr></table></figure>

<p><strong>示例-3</strong></p>
<p>将分支<code>maint</code>合并到当前分支中，但不要自动进行新的提交：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git merge --no-commit maint</span></span><br></pre></td></tr></table></figure>

<p>当您想要对合并进行进一步更改时，可以使用此选项，或者想要自己编写合并提交消息。应该不要滥用这个选项来潜入到合并提交中。小修补程序，如版本名称将是可以接受的。</p>
<p><strong>示例-4</strong></p>
<p>将分支<code>dev</code>合并到当前分支中，自动进行新的提交：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git merge dev</span></span><br></pre></td></tr></table></figure>

<h1 id="Git-fetch"><a href="#Git-fetch" class="headerlink" title="Git fetch"></a>Git fetch</h1><h1 id="Git-pull"><a href="#Git-pull" class="headerlink" title="Git pull"></a>Git pull</h1><p><code>git pull</code>命令用于从另一个存储库或本地分支获取并集成(整合)。<code>git pull</code>命令的作用是：取回远程主机某个分支的更新，再与本地的指定分支合并，它的完整格式稍稍有点复杂。</p>
<p><strong>使用语法</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git pull [options] [&lt;repository&gt; [&lt;refspec&gt;…]]</span><br></pre></td></tr></table></figure>

<h2 id="描述-3"><a href="#描述-3" class="headerlink" title="描述"></a>描述</h2><p>将远程存储库中的更改合并到当前分支中。在默认模式下，<code>git pull</code>是<code>git fetch</code>后跟<code>git merge FETCH_HEAD</code>的缩写。</p>
<p>更准确地说，<code>git pull</code>使用给定的参数运行<code>git fetch</code>，并调用<code>git merge</code>将检索到的分支头合并到当前分支中。 使用<code>--rebase</code>，它运行<code>git rebase</code>而不是<code>git merge</code>。</p>
<h2 id="示例-3"><a href="#示例-3" class="headerlink" title="示例"></a>示例</h2><p>以下是一些示例 -</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git pull &lt;远程主机名&gt; &lt;远程分支名&gt;:&lt;本地分支名&gt;</span></span><br></pre></td></tr></table></figure>

<p>比如，要取回<code>origin</code>主机的<code>next</code>分支，与本地的<code>master</code>分支合并，需要写成下面这样 -</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git pull origin next:master</span></span><br></pre></td></tr></table></figure>

<p>如果远程分支(<code>next</code>)要与当前分支合并，则冒号后面的部分可以省略。上面命令可以简写为：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git pull origin next</span></span><br></pre></td></tr></table></figure>

<p>上面命令表示，取回<code>origin/next</code>分支，再与当前分支合并。实质上，这等同于先做<code>git fetch</code>，再执行<code>git merge</code>。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git fetch origin</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git merge origin/next</span></span><br></pre></td></tr></table></figure>

<p>在某些场合，Git会自动在本地分支与远程分支之间，建立一种追踪关系(tracking)。比如，在<code>git clone</code>的时候，所有本地分支默认与远程主机的同名分支，建立追踪关系，也就是说，本地的<code>master</code>分支自动”追踪”<code>origin/master</code>分支。</p>
<p>Git也允许手动建立追踪关系。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git branch --<span class="built_in">set</span>-upstream master origin/next</span></span><br></pre></td></tr></table></figure>

<p>上面命令指定<code>master</code>分支追踪<code>origin/next</code>分支。</p>
<p>如果当前分支与远程分支存在追踪关系，<code>git pull</code>就可以省略远程分支名。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git pull origin</span></span><br></pre></td></tr></table></figure>

<p>上面命令表示，本地的当前分支自动与对应的<code>origin</code>主机”追踪分支”(remote-tracking branch)进行合并。</p>
<p>如果当前分支只有一个追踪分支，连远程主机名都可以省略。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git pull</span></span><br></pre></td></tr></table></figure>

<p>上面命令表示，当前分支自动与唯一一个追踪分支进行合并。</p>
<p>如果合并需要采用<code>rebase</code>模式，可以使用<code>–rebase</code>选项。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git pull --rebase &lt;远程主机名&gt; &lt;远程分支名&gt;:&lt;本地分支名&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>git fetch和git pull的区别</strong></p>
<ol>
<li><em>git fetch</em>：相当于是从远程获取最新版本到本地，不会自动合并。</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git fetch origin master</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git <span class="built_in">log</span> -p master..origin/master</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git merge origin/master</span></span><br></pre></td></tr></table></figure>

<p>以上命令的含义：</p>
<ul>
<li>首先从远程的<code>origin</code>的<code>master</code>主分支下载最新的版本到<code>origin/master</code>分支上</li>
<li>然后比较本地的<code>master</code>分支和<code>origin/master</code>分支的差别</li>
<li>最后进行合并</li>
</ul>
<p>上述过程其实可以用以下更清晰的方式来进行：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git fetch origin master:tmp</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git diff tmp </span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git merge tmp</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li><em>git pull</em>：相当于是从远程获取最新版本并<code>merge</code>到本地 </li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git pull origin master</span><br></pre></td></tr></table></figure>

<p>上述命令其实相当于<code>git fetch</code> 和 <code>git merge</code><br>在实际使用中，<code>git fetch</code>更安全一些，因为在<code>merge</code>前，我们可以查看更新情况，然后再决定是否合并。</p>
<h1 id="Git-push"><a href="#Git-push" class="headerlink" title="Git push"></a>Git push</h1><p><code>git push</code>命令用于将本地分支的更新，推送到远程主机。它的格式与<code>git pull</code>命令相似。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git push &lt;远程主机名&gt; &lt;本地分支名&gt;:&lt;远程分支名&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>使用语法</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">git push [--all | --mirror | --tags] [--follow-tags] [--atomic] [-n | --dry-run] [--receive-pack=&lt;git-receive-pack&gt;]</span><br><span class="line">       [--repo=&lt;repository&gt;] [-f | --force] [-d | --delete] [--prune] [-v | --verbose]</span><br><span class="line">       [-u | --set-upstream] [--push-option=&lt;string&gt;]</span><br><span class="line">       [--[no-]signed|--sign=(true|false|if-asked)]</span><br><span class="line">       [--force-with-lease[=&lt;refname&gt;[:&lt;expect&gt;]]]</span><br><span class="line">       [--no-verify] [&lt;repository&gt; [&lt;refspec&gt;…]]</span><br></pre></td></tr></table></figure>

<h2 id="描述-4"><a href="#描述-4" class="headerlink" title="描述"></a>描述</h2><p>使用本地引用更新远程引用，同时发送完成给定引用所需的对象。可以在每次推入存储库时，通过在那里设置挂钩触发一些事件。</p>
<p>当命令行不指定使用<code>&lt;repository&gt;</code>参数推送的位置时，将查询当前分支的<code>branch.*.remote</code>配置以确定要在哪里推送。 如果配置丢失，则默认为<code>origin</code>。</p>
<h2 id="示例-4"><a href="#示例-4" class="headerlink" title="示例"></a>示例</h2><p>以下是一些示例 -</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git push origin master</span></span><br></pre></td></tr></table></figure>

<p>上面命令表示，将本地的<code>master</code>分支推送到<code>origin</code>主机的<code>master</code>分支。如果<code>master</code>不存在，则会被新建。</p>
<p>如果省略本地分支名，则表示删除指定的远程分支，因为这等同于推送一个空的本地分支到远程分支。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git push origin :master</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 等同于</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git push origin --delete master</span></span><br></pre></td></tr></table></figure>

<p>上面命令表示删除<code>origin</code>主机的<code>master</code>分支。如果当前分支与远程分支之间存在追踪关系，则本地分支和远程分支都可以省略。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git push origin</span></span><br></pre></td></tr></table></figure>

<p>上面命令表示，将当前分支推送到<code>origin</code>主机的对应分支。如果当前分支只有一个追踪分支，那么主机名都可以省略。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git push</span></span><br></pre></td></tr></table></figure>

<p>如果当前分支与多个主机存在追踪关系，则可以使用<code>-u</code>选项指定一个默认主机，这样后面就可以不加任何参数使用<code>git push</code>。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git push -u origin master</span></span><br></pre></td></tr></table></figure>

<p>上面命令将本地的<code>master</code>分支推送到<code>origin</code>主机，同时指定<code>origin</code>为默认主机，后面就可以不加任何参数使用<code>git push</code>了。</p>
<p>不带任何参数的<code>git push</code>，默认只推送当前分支，这叫做<code>simple</code>方式。此外，还有一种<code>matching</code>方式，会推送所有有对应的远程分支的本地分支。Git 2.0版本之前，默认采用<code>matching</code>方法，现在改为默认采用<code>simple</code>方式。如果要修改这个设置，可以采用<code>git config</code>命令。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git config --global push.default matching</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 或者</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git config --global push.default simple</span></span><br></pre></td></tr></table></figure>

<p>还有一种情况，就是不管是否存在对应的远程分支，将本地的所有分支都推送到远程主机，这时需要使用<code>–all</code>选项。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git push --all origin</span></span><br></pre></td></tr></table></figure>

<p>上面命令表示，将所有本地分支都推送到<code>origin</code>主机。<br>如果远程主机的版本比本地版本更新，推送时Git会报错，要求先在本地做<code>git pull</code>合并差异，然后再推送到远程主机。这时，如果你一定要推送，可以使用<code>–force</code>选项。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git push --force origin</span></span><br></pre></td></tr></table></figure>

<p>上面命令使用<code>-–force</code>选项，结果导致在远程主机产生一个”非直进式”的合并(non-fast-forward merge)。除非你很确定要这样做，否则应该尽量避免使用<code>–-force</code>选项。</p>
<p>最后，<code>git push</code>不会推送标签(tag)，除非使用<code>–tags</code>选项。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git push origin --tags</span></span><br></pre></td></tr></table></figure>

<p>将当前分支推送到远程的同名的简单方法，如下 - </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git push origin HEAD</span></span><br></pre></td></tr></table></figure>

<p>将当前分支推送到源存储库中的远程引用匹配主机。 这种形式方便推送当前分支，而不考虑其本地名称。如下 - </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git push origin HEAD:master</span></span><br></pre></td></tr></table></figure>

<p><strong>其它示例</strong></p>
<p>1.推送本地分支<code>lbranch-1</code>到新大远程分支<code>rbranch-1</code>：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git push origin lbranch-1:refs/rbranch-1</span></span><br></pre></td></tr></table></figure>

<p>2.推送<code>lbranch-2</code>到已有的<code>rbranch-1</code>，用于补充<code>rbranch-1</code>：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git checkout lbranch-2</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git rebase rbranch-1</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git push origin lbranch-2:refs/rbranch-1</span></span><br></pre></td></tr></table></figure>

<p>3.用本地分支<code>lbranch-3</code>覆盖远程分支<code>rbranch-1</code>：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git push -f origin lbranch-2:refs/rbranch-1</span></span><br></pre></td></tr></table></figure>

<p>或者 - </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git push origin :refs/rbranch-1   //删除远程的rbranch-1分支</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git push origin lbranch-1:refs/rbranch-1</span></span><br></pre></td></tr></table></figure>

<p>4.查看<code>push</code>的结果</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> gitk rbranch-1</span></span><br></pre></td></tr></table></figure>

<p>5.推送tag</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git push origin tag_name</span></span><br></pre></td></tr></table></figure>

<p>6.删除远程标签</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git push origin :tag_name</span></span><br></pre></td></tr></table></figure>

<h1 id="Git-rebase"><a href="#Git-rebase" class="headerlink" title="Git rebase"></a>Git rebase</h1><p><code>git rebase</code>命令在另一个分支基础之上重新应用，用于把一个分支的修改合并到当前分支。</p>
<p><strong>使用语法</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git rebase [-i | --interactive] [options] [--exec &lt;cmd&gt;] [--onto &lt;newbase&gt;]</span><br><span class="line">    [&lt;upstream&gt; [&lt;branch&gt;]]</span><br><span class="line">git rebase [-i | --interactive] [options] [--exec &lt;cmd&gt;] [--onto &lt;newbase&gt;]</span><br><span class="line">    --root [&lt;branch&gt;]</span><br><span class="line">git rebase --continue | --skip | --abort | --quit | --edit-todo</span><br></pre></td></tr></table></figure>

<h2 id="示例-5"><a href="#示例-5" class="headerlink" title="示例"></a>示例</h2><p>假设你现在基于远程分支”<code>origin</code>“，创建一个叫”<code>mywork</code>“的分支。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git checkout -b mywork origin</span></span><br></pre></td></tr></table></figure>

<p>结果如下所示 - </p>
<p><img src="assets/842100748_44775.png" alt="img"></p>
<p>现在我们在这个分支(<em>mywork</em>)做一些修改，然后生成两个提交(commit).</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> vi file.txt</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git commit</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> vi otherfile.txt</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git commit</span></span><br><span class="line">... ...</span><br></pre></td></tr></table></figure>

<p>但是与此同时，有些人也在”<code>origin</code>“分支上做了一些修改并且做了提交了，这就意味着”<code>origin</code>“和”<code>mywork</code>“这两个分支各自”前进”了，它们之间”分叉”了。</p>
<p><img src="assets/810100749_17109.png" alt="img"></p>
<p>在这里，你可以用”<code>pull</code>“命令把”<code>origin</code>“分支上的修改拉下来并且和你的修改合并； 结果看起来就像一个新的”合并的提交”(merge commit):</p>
<p><img src="assets/350100750_71786.png" alt="img"></p>
<p>但是，如果你想让”<code>mywork</code>“分支历史看起来像没有经过任何合并一样，也可以用 <code>git rebase</code>，如下所示:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git checkout mywork</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git rebase origin</span></span><br></pre></td></tr></table></figure>

<p>这些命令会把你的”<code>mywork</code>“分支里的每个提交(commit)取消掉，并且把它们临时 保存为补丁(patch)(这些补丁放到”<code>.git/rebase</code>“目录中),然后把”<code>mywork</code>“分支更新 到最新的”<code>origin</code>“分支，最后把保存的这些补丁应用到”<code>mywork</code>“分支上。</p>
<p><img src="assets/845100751_76810.png" alt="img"></p>
<p>当’<code>mywork</code>‘分支更新之后，它会指向这些新创建的提交(commit),而那些老的提交会被丢弃。 如果运行垃圾收集命令(pruning garbage collection), 这些被丢弃的提交就会删除. </p>
<p><img src="assets/141100752_31232.png" alt="img"></p>
<p>现在我们可以看一下用合并(merge)和用<code>rebase</code>所产生的历史的区别：</p>
<p><img src="assets/645100753_82870.png" alt="img"></p>
<p>在<code>rebase</code>的过程中，也许会出现冲突(conflict)。在这种情况，Git会停止<code>rebase</code>并会让你去解决冲突；在解决完冲突后，用”<code>git add</code>“命令去更新这些内容的索引(index), 然后，你无需执行 <code>git commit</code>,只要执行:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git rebase --<span class="built_in">continue</span></span></span><br></pre></td></tr></table></figure>

<p>这样git会继续应用(apply)余下的补丁。</p>
<h2 id="撤销操作git-rebase-–abort"><a href="#撤销操作git-rebase-–abort" class="headerlink" title="撤销操作git rebase –abort"></a>撤销操作git rebase –abort</h2><p>在任何时候，可以用<code>--abort</code>参数来终止<code>rebase</code>的操作，并且”<code>mywork</code>“ 分支会回到<code>rebase</code>开始前的状态。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git rebase --abort</span></span><br></pre></td></tr></table></figure>

<h1 id="Git-Commit"><a href="#Git-Commit" class="headerlink" title="Git Commit"></a>Git Commit</h1><p>git commit –amend # 增补提交，会使用与当前提交节点相同的父节点进行一次新的提交，旧的提交将会被取消。</p>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ol>
<li><a href="https://www.yiibai.com/git/git_reset.html" target="_blank" rel="noopener">易百教程</a></li>
</ol>

          
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
    </footer>
  </div>
  
  
  
  </article>

    
      

  <article class="post post-type-tags" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/07/07/数据库/Jooq/Jooq：文档/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Heper">
      <meta itemprop="description" content="To be awesome">
      <meta itemprop="image" content="/images/head.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">

        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/07/07/数据库/Jooq/Jooq：文档/" class="post-title-link" itemprop="url">Jooq：文档</a>
              
            
          </h1>
        

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              

              
                
              

              <time title="Erstellt: 2019-07-07 18:04:32 / Geändert am: 21:22:11" itemprop="dateCreated datePublished" datetime="2019-07-07T18:04:32+08:00">2019-07-07</time>
            </span>
          
            

            
          

          
            <span id="/2019/07/07/数据库/Jooq/Jooq：文档/" class="post-meta-item leancloud_visitors" data-flag-title="Jooq：文档">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">Aufrufe: </span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          
            
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="fa fa-comment-o"></i>
    </span>
    
      <span class="post-meta-item-text">Kommentare: </span>
    
  
    <a href="/2019/07/07/数据库/Jooq/Jooq：文档/#comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2019/07/07/数据库/Jooq/Jooq：文档/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
          <br>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
            <h1 id="Jooq"><a href="#Jooq" class="headerlink" title="Jooq"></a>Jooq</h1><h2 id="提出问题"><a href="#提出问题" class="headerlink" title="提出问题"></a>提出问题</h2><h2 id="为什么要用（作用）"><a href="#为什么要用（作用）" class="headerlink" title="为什么要用（作用）"></a>为什么要用（作用）</h2><h3 id="与JPA相比"><a href="#与JPA相比" class="headerlink" title="与JPA相比"></a>与JPA相比</h3><p>到目前为止，只有少数的数据库抽象框架或者库，真正尊重SQL作为语言的一等公民，而包括JPA、EJB、doubts等许多框架都试图隐藏SQL本身，将其范围最小化。</p>
<p>JOOQ填补了这个空白</p>
<h3 id="与LINQ相比"><a href="#与LINQ相比" class="headerlink" title="与LINQ相比"></a>与LINQ相比</h3><h3 id="与SQL相比"><a href="#与SQL相比" class="headerlink" title="与SQL相比"></a>与SQL相比</h3><p>SQL可以作为纯文本编写并通过JDBC API传递，多年来，人们对这种方式保持警惕</p>
<ul>
<li>没有类型安全</li>
<li>没有语法安全</li>
<li>没有绑定值索引安全性</li>
<li>详细的SQL字符串连接</li>
<li>无聊的绑定值索引技术</li>
<li>JDBC中的详细资源和异常处理</li>
<li>一个非常有“状态”的，不是非常面向对象的jdbc api，很难使用</li>
</ul>
<h1 id="JOOQ前置了解"><a href="#JOOQ前置了解" class="headerlink" title="JOOQ前置了解"></a>JOOQ前置了解</h1><h2 id="代码块内容"><a href="#代码块内容" class="headerlink" title="代码块内容"></a>代码块内容</h2><p>若未给出假设，则假定使用的是Oracle语法</p>
<p>当看到独立函数，则是从org.jooq.impl.DSL导入的静态函数。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">每当您看到BOOK / Book，AUTHOR / Author和类似实体时，假设它们是从生成的模式中导入的（静态的）</span><br><span class="line">BOOK.TITLE，AUTHOR.LAST_NAME <span class="comment">//对应com.example.generated.Tables.BOOK.TITLE，com.example.generated.Tables.BOOK.TITLE</span></span><br><span class="line">FK_BOOK_AUTHOR <span class="comment">//对应com.example.generated.Keys.FK_BOOK_AUTHOR</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//每当看到Java代码中使用“create”时，假设这是org.jooq.DSLContext的一个实例。</span></span><br><span class="line"><span class="comment">//它被称为“创建”的原因是，从DSL对象创建了一个jOOQ QueryPart。</span></span><br><span class="line"><span class="comment">//“create”因此是非静态查询DSL的入口点</span></span><br><span class="line">DSLContext create = DSL.using（connection，SQLDialect.ORACLE）;</span><br></pre></td></tr></table></figure>

<h2 id="执行"><a href="#执行" class="headerlink" title="执行"></a>执行</h2><p>JOOQ无法确定声明是否完整，直到执行fetch或者execute</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">create.selectOne().fetch();</span><br><span class="line">create.update(T).set(T.V, <span class="number">1</span>).execute();</span><br></pre></td></tr></table></figure>

<h2 id="设置"><a href="#设置" class="headerlink" title="设置"></a><a href="https://www.jooq.org/doc/3.10/manual/getting-started/the-manual/#N3A272" target="_blank" rel="noopener">设置</a></h2><p>jOOQ允许使用<a href="https://www.jooq.org/javadoc/3.10.x/org/jooq/conf/Settings.html" target="_blank" rel="noopener">org.jooq.conf.Settings</a>覆盖运行时行为。如果未指定任何内容，则假定使用默认运行时设置。</p>
<h2 id="样本数据库"><a href="#样本数据库" class="headerlink" title="样本数据库"></a><a href="https://www.jooq.org/doc/3.10/manual/getting-started/the-manual/#N3A27B" target="_blank" rel="noopener">样本数据库</a></h2><p>jOOQ查询示例针对示例数据库运行。</p>
<h3 id="示例数据库"><a href="#示例数据库" class="headerlink" title="示例数据库"></a>示例数据库</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="keyword">language</span> (</span><br><span class="line">  <span class="keyword">id</span>              <span class="built_in">NUMBER</span>(<span class="number">7</span>)     <span class="keyword">NOT</span> <span class="literal">NULL</span> PRIMARY <span class="keyword">KEY</span>,</span><br><span class="line">  cd              <span class="built_in">CHAR</span>(<span class="number">2</span>)       <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  description     VARCHAR2(<span class="number">50</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> author (</span><br><span class="line">  <span class="keyword">id</span>              <span class="built_in">NUMBER</span>(<span class="number">7</span>)     <span class="keyword">NOT</span> <span class="literal">NULL</span> PRIMARY <span class="keyword">KEY</span>,</span><br><span class="line">  first_name      VARCHAR2(<span class="number">50</span>),</span><br><span class="line">  last_name       VARCHAR2(<span class="number">50</span>)  <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  date_of_birth   <span class="built_in">DATE</span>,</span><br><span class="line">  year_of_birth   <span class="built_in">NUMBER</span>(<span class="number">7</span>),</span><br><span class="line">  distinguished   <span class="built_in">NUMBER</span>(<span class="number">1</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> book (</span><br><span class="line">  <span class="keyword">id</span>              <span class="built_in">NUMBER</span>(<span class="number">7</span>)     <span class="keyword">NOT</span> <span class="literal">NULL</span> PRIMARY <span class="keyword">KEY</span>,</span><br><span class="line">  author_id       <span class="built_in">NUMBER</span>(<span class="number">7</span>)     <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  title           VARCHAR2(<span class="number">400</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  published_in    <span class="built_in">NUMBER</span>(<span class="number">7</span>)     <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  language_id     <span class="built_in">NUMBER</span>(<span class="number">7</span>)     <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">CONSTRAINT</span> fk_book_author     <span class="keyword">FOREIGN</span> <span class="keyword">KEY</span> (author_id)   <span class="keyword">REFERENCES</span> author(<span class="keyword">id</span>),</span><br><span class="line">  <span class="keyword">CONSTRAINT</span> fk_book_language   <span class="keyword">FOREIGN</span> <span class="keyword">KEY</span> (language_id) <span class="keyword">REFERENCES</span> <span class="keyword">language</span>(<span class="keyword">id</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> book_store (</span><br><span class="line">  <span class="keyword">name</span>            VARCHAR2(<span class="number">400</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">UNIQUE</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> book_to_book_store (</span><br><span class="line">  <span class="keyword">name</span>            VARCHAR2(<span class="number">400</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  book_id         <span class="built_in">INTEGER</span>       <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  stock           <span class="built_in">INTEGER</span>,</span><br><span class="line">  </span><br><span class="line">  PRIMARY <span class="keyword">KEY</span>(<span class="keyword">name</span>, book_id),</span><br><span class="line">  <span class="keyword">CONSTRAINT</span> fk_b2bs_book_store <span class="keyword">FOREIGN</span> <span class="keyword">KEY</span> (<span class="keyword">name</span>)        <span class="keyword">REFERENCES</span> book_store (<span class="keyword">name</span>) <span class="keyword">ON</span> <span class="keyword">DELETE</span> <span class="keyword">CASCADE</span>,</span><br><span class="line">  <span class="keyword">CONSTRAINT</span> fk_b2bs_book       <span class="keyword">FOREIGN</span> <span class="keyword">KEY</span> (book_id)     <span class="keyword">REFERENCES</span> book (<span class="keyword">id</span>)         <span class="keyword">ON</span> <span class="keyword">DELETE</span> <span class="keyword">CASCADE</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h3 id="示例数据"><a href="#示例数据" class="headerlink" title="示例数据"></a>示例数据</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="keyword">language</span> (<span class="keyword">id</span>, cd, description) <span class="keyword">VALUES</span> (<span class="number">1</span>, <span class="string">'en'</span>, <span class="string">'English'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="keyword">language</span> (<span class="keyword">id</span>, cd, description) <span class="keyword">VALUES</span> (<span class="number">2</span>, <span class="string">'de'</span>, <span class="string">'Deutsch'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="keyword">language</span> (<span class="keyword">id</span>, cd, description) <span class="keyword">VALUES</span> (<span class="number">3</span>, <span class="string">'fr'</span>, <span class="string">'Français'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="keyword">language</span> (<span class="keyword">id</span>, cd, description) <span class="keyword">VALUES</span> (<span class="number">4</span>, <span class="string">'pt'</span>, <span class="string">'Português'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> author (<span class="keyword">id</span>, first_name, last_name, date_of_birth    , year_of_birth)</span><br><span class="line">  <span class="keyword">VALUES</span>           (<span class="number">1</span> , <span class="string">'George'</span>  , <span class="string">'Orwell'</span> , <span class="built_in">DATE</span> <span class="string">'1903-06-26'</span>, <span class="number">1903</span>         );</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> author (<span class="keyword">id</span>, first_name, last_name, date_of_birth    , year_of_birth)</span><br><span class="line">  <span class="keyword">VALUES</span>           (<span class="number">2</span> , <span class="string">'Paulo'</span>   , <span class="string">'Coelho'</span> , <span class="built_in">DATE</span> <span class="string">'1947-08-24'</span>, <span class="number">1947</span>         );</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> book (<span class="keyword">id</span>, author_id, title         , published_in, language_id)</span><br><span class="line">  <span class="keyword">VALUES</span>         (<span class="number">1</span> , <span class="number">1</span>        , <span class="string">'1984'</span>        , <span class="number">1948</span>        , <span class="number">1</span>          );</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> book (<span class="keyword">id</span>, author_id, title         , published_in, language_id)</span><br><span class="line">  <span class="keyword">VALUES</span>         (<span class="number">2</span> , <span class="number">1</span>        , <span class="string">'Animal Farm'</span> , <span class="number">1945</span>        , <span class="number">1</span>          );</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> book (<span class="keyword">id</span>, author_id, title         , published_in, language_id)</span><br><span class="line">  <span class="keyword">VALUES</span>         (<span class="number">3</span> , <span class="number">2</span>        , <span class="string">'O Alquimista'</span>, <span class="number">1988</span>        , <span class="number">4</span>          );</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> book (<span class="keyword">id</span>, author_id, title         , published_in, language_id)</span><br><span class="line">  <span class="keyword">VALUES</span>         (<span class="number">4</span> , <span class="number">2</span>        , <span class="string">'Brida'</span>       , <span class="number">1990</span>        , <span class="number">2</span>          );</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> book_store <span class="keyword">VALUES</span> (<span class="string">'Orell Füssli'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> book_store <span class="keyword">VALUES</span> (<span class="string">'Ex Libris'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> book_store <span class="keyword">VALUES</span> (<span class="string">'Buchhandlung im Volkshaus'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> book_to_book_store <span class="keyword">VALUES</span> (<span class="string">'Orell Füssli'</span>             , <span class="number">1</span>, <span class="number">10</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> book_to_book_store <span class="keyword">VALUES</span> (<span class="string">'Orell Füssli'</span>             , <span class="number">2</span>, <span class="number">10</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> book_to_book_store <span class="keyword">VALUES</span> (<span class="string">'Orell Füssli'</span>             , <span class="number">3</span>, <span class="number">10</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> book_to_book_store <span class="keyword">VALUES</span> (<span class="string">'Ex Libris'</span>                , <span class="number">1</span>, <span class="number">1</span> );</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> book_to_book_store <span class="keyword">VALUES</span> (<span class="string">'Ex Libris'</span>                , <span class="number">3</span>, <span class="number">2</span> );</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> book_to_book_store <span class="keyword">VALUES</span> (<span class="string">'Buchhandlung im Volkshaus'</span>, <span class="number">3</span>, <span class="number">1</span> );</span><br></pre></td></tr></table></figure>

<h2 id="不同的使用情况进行JOOQ"><a href="#不同的使用情况进行JOOQ" class="headerlink" title="不同的使用情况进行JOOQ"></a>不同的使用情况进行JOOQ</h2><h3 id="JOOQ作为SQL构建器"><a href="#JOOQ作为SQL构建器" class="headerlink" title="JOOQ作为SQL构建器"></a>JOOQ作为SQL构建器</h3><p>允许为任何数据库构建有效的SQL，使用JOOQ的查询DSL API将字符串、文字和其他用户定义的对象包装到面向对象、类型安全的AST当中，为SQL建模</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Fetch a SQL string from a jOOQ Query in order to manually execute it with another tool.</span></span><br><span class="line"><span class="comment">// For simplicity reasons, we're using the API to construct case-insensitive object references, here.</span></span><br><span class="line">String sql = create.select(field(<span class="string">"BOOK.TITLE"</span>), field(<span class="string">"AUTHOR.FIRST_NAME"</span>), field(<span class="string">"AUTHOR.LAST_NAME"</span>))</span><br><span class="line">                   .from(table(<span class="string">"BOOK"</span>))</span><br><span class="line">                   .join(table(<span class="string">"AUTHOR"</span>))</span><br><span class="line">                   .on(field(<span class="string">"BOOK.AUTHOR_ID"</span>).eq(field(<span class="string">"AUTHOR.ID"</span>)))</span><br><span class="line">                   .where(field(<span class="string">"BOOK.PUBLISHED_IN"</span>).eq(<span class="number">1948</span>))</span><br><span class="line">                   .getSQL();</span><br></pre></td></tr></table></figure>

<p>之后，该sql语句可以直接使用JDBC进行执行，</p>
<h3 id="JOOQ作为具有代码生成的SQL构建器"><a href="#JOOQ作为具有代码生成的SQL构建器" class="headerlink" title="JOOQ作为具有代码生成的SQL构建器"></a>JOOQ作为具有代码生成的SQL构建器</h3><h3 id="JOOQ作为SQL执行器"><a href="#JOOQ作为SQL执行器" class="headerlink" title="JOOQ作为SQL执行器"></a>JOOQ作为SQL执行器</h3><p>使用JOOQ直接执行JOOQ生成的SQL语句，通过让JOOQ执行SQL，JOOQ查询DSL成为真正的嵌入式SQL</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Typesafely execute the SQL statement directly with jOOQ</span></span><br><span class="line">Result&lt;Record3&lt;String, String, String&gt;&gt; result =</span><br><span class="line">create.select(BOOK.TITLE, AUTHOR.FIRST_NAME, AUTHOR.LAST_NAME)</span><br><span class="line">      .from(BOOK)</span><br><span class="line">      .join(AUTHOR)</span><br><span class="line">      .on(BOOK.AUTHOR_ID.eq(AUTHOR.ID))</span><br><span class="line">      .where(BOOK.PUBLISHED_IN.eq(<span class="number">1948</span>))</span><br><span class="line">      .fetch();</span><br></pre></td></tr></table></figure>

<p>并且可以使用任何的SQL构建工具构建SQL语句，之后由JOOQ运行SQL语句。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Use your favourite tool to construct SQL strings:</span></span><br><span class="line">String sql = <span class="string">"SELECT title, first_name, last_name FROM book JOIN author ON book.author_id = author.id "</span> +</span><br><span class="line">             <span class="string">"WHERE book.published_in = 1984"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Fetch results using jOOQ</span></span><br><span class="line">Result&lt;Record&gt; result = create.fetch(sql);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Or execute that SQL with JDBC, fetching the ResultSet with jOOQ:</span></span><br><span class="line">ResultSet rs = connection.createStatement().executeQuery(sql);</span><br><span class="line">Result&lt;Record&gt; result = create.fetch(rs);</span><br></pre></td></tr></table></figure>

<h3 id="JOOQ-for-CURD"><a href="#JOOQ-for-CURD" class="headerlink" title="JOOQ for CURD"></a>JOOQ for CURD</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Fetch an author</span></span><br><span class="line">AuthorRecord author : create.fetchOne(AUTHOR, AUTHOR.ID.eq(<span class="number">1</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create a new author, if it doesn't exist yet</span></span><br><span class="line"><span class="keyword">if</span> (author == <span class="keyword">null</span>) &#123;</span><br><span class="line">    author = create.newRecord(AUTHOR);</span><br><span class="line">    author.setId(<span class="number">1</span>);</span><br><span class="line">    author.setFirstName(<span class="string">"Dan"</span>);</span><br><span class="line">    author.setLastName(<span class="string">"Brown"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Mark the author as a "distinguished" author and store it</span></span><br><span class="line">author.setDistinguished(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Executes an update on existing authors, or insert on new ones</span></span><br><span class="line">author.store();</span><br></pre></td></tr></table></figure>

<h3 id="PRO的JOOQ"><a href="#PRO的JOOQ" class="headerlink" title="PRO的JOOQ"></a>PRO的JOOQ</h3><h2 id="JOOQ的工具"><a href="#JOOQ的工具" class="headerlink" title="JOOQ的工具"></a>JOOQ的工具</h2><ul>
<li><a href="https://www.jooq.org/doc/3.10/manual/sql-execution/execute-listeners/" target="_blank" rel="noopener">jOOQ的执行监听器</a>：jOOQ允许您将自定义执行监听器挂钩到jOOQ的SQL语句执行生命周期中，以集中协调对正在执行的SQL执行的任何操作。用于记录，标识生成，SQL跟踪，性能测量等。</li>
<li><a href="https://www.jooq.org/doc/3.10/manual/sql-execution/logging/" target="_blank" rel="noopener">记录</a>：jOOQ内置一个标准的DEBUG记录器，用于记录和跟踪所有已执行的SQL语句和获取的结果集</li>
<li><a href="https://www.jooq.org/doc/3.10/manual/sql-execution/stored-procedures/" target="_blank" rel="noopener">存储过程</a>：jOOQ支持您喜欢的数据库的存储过程和函数。生成所有例程和用户定义类型，并且可以作为函数引用包含在jOOQ的SQL构建API中。</li>
<li><a href="https://www.jooq.org/doc/3.10/manual/sql-execution/batch-execution/" target="_blank" rel="noopener">批量执行</a>：执行大量SQL语句时，批量执行很重要。与JDBC相比，jOOQ简化了这些操作</li>
<li><a href="https://www.jooq.org/doc/3.10/manual/sql-execution/exporting/" target="_blank" rel="noopener">导出</a>和<a href="https://www.jooq.org/doc/3.10/manual/sql-execution/importing/" target="_blank" rel="noopener">导入</a>：jOOQ附带API，可以轻松导出/导入各种格式的数据</li>
</ul>
<h1 id="JOOQ教程入门"><a href="#JOOQ教程入门" class="headerlink" title="JOOQ教程入门"></a>JOOQ教程入门</h1><h2 id="JOOQ简单7个步骤"><a href="#JOOQ简单7个步骤" class="headerlink" title="JOOQ简单7个步骤"></a>JOOQ简单7个步骤</h2><h3 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h3><p>JOOQ的<strong><em>maven</em></strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.jooq<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jooq<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.10.8<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.jooq<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jooq-meta<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.10.8<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.jooq<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jooq-codegen<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.10.8<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><a href="https://www.jooq.org/doc/3.10/manual/getting-started/tutorials/jooq-in-7-steps/jooq-in-7-steps-step1/" target="_blank" rel="noopener">商业版</a></p>
<h3 id="数据库"><a href="#数据库" class="headerlink" title="数据库"></a>数据库</h3><p>创建一个library的数据库以及一个对应的author表</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">DATABASE</span> <span class="string">`library`</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">USE</span> <span class="string">`library`</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`author`</span> (</span><br><span class="line">  <span class="string">`id`</span> <span class="built_in">int</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`first_name`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`last_name`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h3 id="代码生成"><a href="#代码生成" class="headerlink" title="代码生成"></a>代码生成</h3><p>使用JOOQ的命令行工具生成映射到我们刚创建的Author表的类。详细信息参照：<a href="https://www.jooq.org/doc/3.10/manual/code-generation/" target="_blank" rel="noopener">关于设置代码生成器的jOOQ手册页</a></p>
<p>最简单的方式是将JOOQ的jar文件（3个）以及数据库的connect文件复制到临时目录下，创建一个library.xml</p>
<ul>
<li>更新用户名、url、driver等数据</li>
<li><code>database.includes</code>里包含要创建的数据库表，<code>database.excludes</code>包含需要排除的数据库表</li>
<li><code>generator.target.package</code> - 将其设置为要为生成的类创建的父包。</li>
<li>设置<code>test.generated</code>将导致<code>test.generated.Author</code>和<code>test.generated.AuthorRecord</code>创建</li>
<li><code>generator.target.directory</code> - 要输出的目录。</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span> <span class="attr">xmlns</span>=<span class="string">"http://www.jooq.org/xsd/jooq-codegen-3.10.0.xsd"</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- Configure the database connection here --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">jdbc</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">driver</span>&gt;</span>com.mysql.jdbc.Driver<span class="tag">&lt;/<span class="name">driver</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url</span>&gt;</span>jdbc:mysql://localhost:3306/library<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">user</span>&gt;</span>root<span class="tag">&lt;/<span class="name">user</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">password</span>&gt;</span><span class="tag">&lt;/<span class="name">password</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">jdbc</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">generator</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- The default code generator. You can override this one, to generate your own code style.</span></span><br><span class="line"><span class="comment">         Supported generators:</span></span><br><span class="line"><span class="comment">         - org.jooq.util.JavaGenerator</span></span><br><span class="line"><span class="comment">         - org.jooq.util.ScalaGenerator</span></span><br><span class="line"><span class="comment">         Defaults to org.jooq.util.JavaGenerator </span></span><br><span class="line"><span class="comment">         </span></span><br><span class="line"><span class="comment">         Note the classes have been moved to org.jooq.codegen or org.jooq.meta in jOOQ 3.11 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>org.jooq.util.JavaGenerator<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">database</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- The database type. The format here is:</span></span><br><span class="line"><span class="comment">           org.jooq.util.[database].[database]Database</span></span><br><span class="line"><span class="comment">       </span></span><br><span class="line"><span class="comment">           Note the classes have been moved to org.jooq.codegen or org.jooq.meta in jOOQ 3.11 --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">name</span>&gt;</span>org.jooq.util.mysql.MySQLDatabase<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">&lt;!-- The database schema (or in the absence of schema support, in your RDBMS this</span></span><br><span class="line"><span class="comment">           can be the owner, user, database name) to be generated --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">inputSchema</span>&gt;</span>library<span class="tag">&lt;/<span class="name">inputSchema</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">&lt;!-- All elements that are generated from your schema</span></span><br><span class="line"><span class="comment">           (A Java regular expression. Use the pipe to separate several expressions)</span></span><br><span class="line"><span class="comment">           Watch out for case-sensitivity. Depending on your database, this might be important! --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">includes</span>&gt;</span>.*<span class="tag">&lt;/<span class="name">includes</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">&lt;!-- All elements that are excluded from your schema</span></span><br><span class="line"><span class="comment">           (A Java regular expression. Use the pipe to separate several expressions).</span></span><br><span class="line"><span class="comment">           Excludes match before includes, i.e. excludes have a higher priority --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">excludes</span>&gt;</span><span class="tag">&lt;/<span class="name">excludes</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">database</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">target</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- The destination package of your generated classes (within the destination directory) --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">packageName</span>&gt;</span>test.generated<span class="tag">&lt;/<span class="name">packageName</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">&lt;!-- The destination directory of your generated classes. Using Maven directory layout here --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">directory</span>&gt;</span>C:/workspace/MySQLTest/src/main/java<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">target</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">generator</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>到达临时目录后，windows键入。记得替换文件名称</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">java -classpath jooq-3.10.8.jar; jooq-meta-3.10.8.jar; jooq-codegen-3.10.8.jar; mysql-connector-java-5.1.18-bin.jar;。</span><br><span class="line">  org.jooq.util.GenerationTool library.xml</span><br></pre></td></tr></table></figure>

<p>mac键入</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">java -classpath jooq-3.10.8.jar：jooq-meta-3.10.8.jar：jooq-codegen-3.10.8.jar：mysql-connector-java-5.1.18-bin.jar：。</span><br><span class="line">  org.jooq.util.GenerationTool library.xml</span><br></pre></td></tr></table></figure>

<p>成功后的输出</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">Nov <span class="number">1</span>, <span class="number">2011</span> <span class="number">7</span>:<span class="number">25</span>:<span class="number">06</span> PM org.jooq.impl.JooqLogger info</span><br><span class="line">INFO: Initialising properties  : /library.xml</span><br><span class="line">Nov <span class="number">1</span>, <span class="number">2011</span> <span class="number">7</span>:<span class="number">25</span>:<span class="number">07</span> PM org.jooq.impl.JooqLogger info</span><br><span class="line">INFO: Database parameters</span><br><span class="line">Nov <span class="number">1</span>, <span class="number">2011</span> <span class="number">7</span>:<span class="number">25</span>:<span class="number">07</span> PM org.jooq.impl.JooqLogger info</span><br><span class="line">INFO: ----------------------------------------------------------</span><br><span class="line">Nov <span class="number">1</span>, <span class="number">2011</span> <span class="number">7</span>:<span class="number">25</span>:<span class="number">07</span> PM org.jooq.impl.JooqLogger info</span><br><span class="line">INFO:   dialect                : MYSQL</span><br><span class="line">Nov <span class="number">1</span>, <span class="number">2011</span> <span class="number">7</span>:<span class="number">25</span>:<span class="number">07</span> PM org.jooq.impl.JooqLogger info</span><br><span class="line">INFO:   schema                 : library</span><br><span class="line">Nov <span class="number">1</span>, <span class="number">2011</span> <span class="number">7</span>:<span class="number">25</span>:<span class="number">07</span> PM org.jooq.impl.JooqLogger info</span><br><span class="line">INFO:   target dir             : C:/workspace/MySQLTest/src</span><br><span class="line">Nov <span class="number">1</span>, <span class="number">2011</span> <span class="number">7</span>:<span class="number">25</span>:<span class="number">07</span> PM org.jooq.impl.JooqLogger info</span><br><span class="line">INFO:   target <span class="keyword">package</span>         : test.generated</span><br><span class="line">Nov <span class="number">1</span>, <span class="number">2011</span> <span class="number">7</span>:<span class="number">25</span>:<span class="number">07</span> PM org.jooq.impl.JooqLogger info</span><br><span class="line">INFO: ----------------------------------------------------------</span><br><span class="line">Nov <span class="number">1</span>, <span class="number">2011</span> <span class="number">7</span>:<span class="number">25</span>:<span class="number">07</span> PM org.jooq.impl.JooqLogger info</span><br><span class="line">INFO: Emptying                 : C:/workspace/MySQLTest/src/test/generated</span><br><span class="line">Nov <span class="number">1</span>, <span class="number">2011</span> <span class="number">7</span>:<span class="number">25</span>:<span class="number">07</span> PM org.jooq.impl.JooqLogger info</span><br><span class="line">INFO: Generating classes in    : C:/workspace/MySQLTest/src/test/generated</span><br><span class="line">Nov <span class="number">1</span>, <span class="number">2011</span> <span class="number">7</span>:<span class="number">25</span>:<span class="number">07</span> PM org.jooq.impl.JooqLogger info</span><br><span class="line">INFO: Generating schema        : Library.java</span><br><span class="line">Nov <span class="number">1</span>, <span class="number">2011</span> <span class="number">7</span>:<span class="number">25</span>:<span class="number">07</span> PM org.jooq.impl.JooqLogger info</span><br><span class="line">INFO: Schema generated         : Total: <span class="number">122.18</span>ms</span><br><span class="line">Nov <span class="number">1</span>, <span class="number">2011</span> <span class="number">7</span>:<span class="number">25</span>:<span class="number">07</span> PM org.jooq.impl.JooqLogger info</span><br><span class="line">INFO: Sequences fetched        : <span class="number">0</span> (<span class="number">0</span> included, <span class="number">0</span> excluded)</span><br><span class="line">Nov <span class="number">1</span>, <span class="number">2011</span> <span class="number">7</span>:<span class="number">25</span>:<span class="number">07</span> PM org.jooq.impl.JooqLogger info</span><br><span class="line">INFO: Tables fetched           : <span class="number">5</span> (<span class="number">5</span> included, <span class="number">0</span> excluded)</span><br><span class="line">Nov <span class="number">1</span>, <span class="number">2011</span> <span class="number">7</span>:<span class="number">25</span>:<span class="number">07</span> PM org.jooq.impl.JooqLogger info</span><br><span class="line">INFO: Generating tables        : C:/workspace/MySQLTest/src/test/generated/tables</span><br><span class="line">Nov <span class="number">1</span>, <span class="number">2011</span> <span class="number">7</span>:<span class="number">25</span>:<span class="number">07</span> PM org.jooq.impl.JooqLogger info</span><br><span class="line">INFO: ARRAYs fetched           : <span class="number">0</span> (<span class="number">0</span> included, <span class="number">0</span> excluded)</span><br><span class="line">Nov <span class="number">1</span>, <span class="number">2011</span> <span class="number">7</span>:<span class="number">25</span>:<span class="number">07</span> PM org.jooq.impl.JooqLogger info</span><br><span class="line">INFO: Enums fetched            : <span class="number">0</span> (<span class="number">0</span> included, <span class="number">0</span> excluded)</span><br><span class="line">Nov <span class="number">1</span>, <span class="number">2011</span> <span class="number">7</span>:<span class="number">25</span>:<span class="number">07</span> PM org.jooq.impl.JooqLogger info</span><br><span class="line">INFO: UDTs fetched             : <span class="number">0</span> (<span class="number">0</span> included, <span class="number">0</span> excluded)</span><br><span class="line">Nov <span class="number">1</span>, <span class="number">2011</span> <span class="number">7</span>:<span class="number">25</span>:<span class="number">07</span> PM org.jooq.impl.JooqLogger info</span><br><span class="line">INFO: Generating table         : Author.java</span><br><span class="line">Nov <span class="number">1</span>, <span class="number">2011</span> <span class="number">7</span>:<span class="number">25</span>:<span class="number">07</span> PM org.jooq.impl.JooqLogger info</span><br><span class="line">INFO: Tables generated         : Total: <span class="number">680.464</span>ms, +<span class="number">558.284</span>ms</span><br><span class="line">Nov <span class="number">1</span>, <span class="number">2011</span> <span class="number">7</span>:<span class="number">25</span>:<span class="number">07</span> PM org.jooq.impl.JooqLogger info</span><br><span class="line">INFO: Generating Keys          : C:/workspace/MySQLTest/src/test/generated/tables</span><br><span class="line">Nov <span class="number">1</span>, <span class="number">2011</span> <span class="number">7</span>:<span class="number">25</span>:<span class="number">08</span> PM org.jooq.impl.JooqLogger info</span><br><span class="line">INFO: Keys generated           : Total: <span class="number">718.621</span>ms, +<span class="number">38.157</span>ms</span><br><span class="line">Nov <span class="number">1</span>, <span class="number">2011</span> <span class="number">7</span>:<span class="number">25</span>:<span class="number">08</span> PM org.jooq.impl.JooqLogger info</span><br><span class="line">INFO: Generating records       : C:/workspace/MySQLTest/src/test/generated/tables/records</span><br><span class="line">Nov <span class="number">1</span>, <span class="number">2011</span> <span class="number">7</span>:<span class="number">25</span>:<span class="number">08</span> PM org.jooq.impl.JooqLogger info</span><br><span class="line">INFO: Generating record        : AuthorRecord.java</span><br><span class="line">Nov <span class="number">1</span>, <span class="number">2011</span> <span class="number">7</span>:<span class="number">25</span>:<span class="number">08</span> PM org.jooq.impl.JooqLogger info</span><br><span class="line">INFO: Table records generated  : Total: <span class="number">782.545</span>ms, +<span class="number">63.924</span>ms</span><br><span class="line">Nov <span class="number">1</span>, <span class="number">2011</span> <span class="number">7</span>:<span class="number">25</span>:<span class="number">08</span> PM org.jooq.impl.JooqLogger info</span><br><span class="line">INFO: Routines fetched         : <span class="number">0</span> (<span class="number">0</span> included, <span class="number">0</span> excluded)</span><br><span class="line">Nov <span class="number">1</span>, <span class="number">2011</span> <span class="number">7</span>:<span class="number">25</span>:<span class="number">08</span> PM org.jooq.impl.JooqLogger info</span><br><span class="line">INFO: Packages fetched         : <span class="number">0</span> (<span class="number">0</span> included, <span class="number">0</span> excluded)</span><br><span class="line">Nov <span class="number">1</span>, <span class="number">2011</span> <span class="number">7</span>:<span class="number">25</span>:<span class="number">08</span> PM org.jooq.impl.JooqLogger info</span><br><span class="line">INFO: GENERATION FINISHED!     : Total: <span class="number">791.688</span>ms, +<span class="number">9.143</span>ms</span><br></pre></td></tr></table></figure>

<h3 id="连接到数据库"><a href="#连接到数据库" class="headerlink" title="连接到数据库"></a>连接到数据库</h3><p>连接数据库</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// For convenience, always static import your generated tables and jOOQ functions to decrease verbosity:</span></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> test.generated.Tables.*;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.jooq.impl.DSL.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.sql.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String userName = <span class="string">"root"</span>;</span><br><span class="line">        String password = <span class="string">""</span>;</span><br><span class="line">        String url = <span class="string">"jdbc:mysql://localhost:3306/library"</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Connection is the only JDBC resource that we need</span></span><br><span class="line">        <span class="comment">// PreparedStatement and ResultSet are handled by jOOQ, internally</span></span><br><span class="line">        <span class="keyword">try</span> (Connection conn = DriverManager.getConnection(url, userName, password)) &#123;</span><br><span class="line">            <span class="comment">// ...</span></span><br><span class="line">        &#125; </span><br><span class="line"></span><br><span class="line">        <span class="comment">// For the sake of this tutorial, let's keep exception handling simple</span></span><br><span class="line">        <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="查询"><a href="#查询" class="headerlink" title="查询"></a>查询</h3><p>DSL不会自己关闭，需要我们自己去完成</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">DSLContext create = DSL.using(conn, SQLDialect.MYSQL);</span><br><span class="line">Result&lt;Record&gt; result = create.select().from(AUTHOR).fetch();</span><br></pre></td></tr></table></figure>

<h3 id="迭代"><a href="#迭代" class="headerlink" title="迭代"></a>迭代</h3><p>打印结果</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (Record r : result) &#123;</span><br><span class="line">    Integer id = r.getValue(AUTHOR.ID);</span><br><span class="line">    String firstName = r.getValue(AUTHOR.FIRST_NAME);</span><br><span class="line">    String lastName = r.getValue(AUTHOR.LAST_NAME);</span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">"ID: "</span> + id + <span class="string">" first name: "</span> + firstName + <span class="string">" last name: "</span> + lastName);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="探索"><a href="#探索" class="headerlink" title="探索"></a>探索</h3><h1 id="数据库版本管理工具Flyway"><a href="#数据库版本管理工具Flyway" class="headerlink" title="数据库版本管理工具Flyway"></a>数据库版本管理工具Flyway</h1><h2 id="Flyway简介"><a href="#Flyway简介" class="headerlink" title="Flyway简介"></a>Flyway简介</h2><p>Flyway是独立于数据库的应用、管理、跟踪数据库变更的数据库版本管理工具。<br>Flyway的项目主页是：<a href="https://flywaydb.org/" target="_blank" rel="noopener">https://flywaydb.org/</a></p>
<h3 id="为什么使用Flyway"><a href="#为什么使用Flyway" class="headerlink" title="为什么使用Flyway"></a>为什么使用Flyway</h3><ul>
<li>不同的开发人员在开发产品特性时，都有可能更新数据库（添加新表，新的约束等）。当开发人员完成工作并提交代码时，代码会被合并到主分支并在测试服务器上执行单元测试与集成测试。我们在哪个环节来执行数据库的更新操作呢？由QA 部门手工执行sql 脚本？或者我们开发一断程序自动执行数据库更新？以什么顺序来执行这些更新脚本？这些问题同样存在于生产环境。</li>
<li>我们的产品部署在不同的客户服务器上，以及很多的测试、联调、实验局、销售环境上。不同的客户和测试环境上都部署着不同版本的产品。当他们需要升级他们的产品到新的版本时，我们不仅需要让他们的管理员可以升级产品到新的版本，同时需要保留他们的已有数据。在升级产品的步骤中，我们清楚地知道客户数据库的当前版本，以及需要在该数据库上执行哪些数据库更新脚本，来更新数据库表结构与数据库中已存在的数据。当升级完成时，数据库表结构及数据应当与升级后的产品版本保持一致。</li>
<li>当升级失败时（比如在升级过程中出现网络连接失败），我们应当支持对失败进行修复。</li>
</ul>
<h3 id="更多Flyway文章（参考以下文档）"><a href="#更多Flyway文章（参考以下文档）" class="headerlink" title="更多Flyway文章（参考以下文档）"></a>更多Flyway文章（参考以下文档）</h3><ul>
<li><a href="http://casheen.iteye.com/blog/1749916" target="_blank" rel="noopener">数据库版本管理工具Flyway——基础篇</a></li>
<li><a href="http://blog.csdn.net/tanghin/article/details/51264795" target="_blank" rel="noopener">Flyway学习笔记</a></li>
<li><a href="https://flywaydb.org/documentation/" target="_blank" rel="noopener">官方文档</a></li>
</ul>
<h2 id="Maven配置"><a href="#Maven配置" class="headerlink" title="Maven配置"></a>Maven配置</h2><p>在pom文件当中定义如下属性，以便在插件配置中进行重用</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">db.url</span>&gt;</span>jdbc:h2:~/flyway-test<span class="tag">&lt;/<span class="name">db.url</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">db.username</span>&gt;</span>sa<span class="tag">&lt;/<span class="name">db.username</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="maven项目配置"><a href="#maven项目配置" class="headerlink" title="maven项目配置"></a>maven项目配置</h3><p><strong><em>依赖</em></strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- We'll add the latest version of jOOQ and our JDBC driver - in this case H2 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Use org.jooq            for the Open Source Edition</span></span><br><span class="line"><span class="comment">             org.jooq.pro        for commercial editions, </span></span><br><span class="line"><span class="comment">             org.jooq.pro-java-6 for commercial editions with Java 6 support,</span></span><br><span class="line"><span class="comment">             org.jooq.trial      for the free trial edition </span></span><br><span class="line"><span class="comment">             </span></span><br><span class="line"><span class="comment">         <span class="doctag">Note:</span> Only the Open Source Edition is hosted on Maven Central. </span></span><br><span class="line"><span class="comment">               Import the others manually from your distribution --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.jooq<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jooq<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.10.8<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.h2database<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>h2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.4.177<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- For improved logging, we'll be using log4j via slf4j to see what's going on during migration and code generation --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.16<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-log4j12<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.7.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- To ensure our code is working, we're using JUnit --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.11<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong><em>Flyway插件</em></strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.flywaydb<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>flyway-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Note that we're executing the Flyway plugin in the "generate-sources" phase --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">phase</span>&gt;</span>generate-sources<span class="tag">&lt;/<span class="name">phase</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">goal</span>&gt;</span>migrate<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Note that we need to prefix the db/migration path with filesystem: to prevent Flyway</span></span><br><span class="line"><span class="comment">         from looking for our migration scripts only on the classpath --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url</span>&gt;</span>$&#123;db.url&#125;<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">user</span>&gt;</span>$&#123;db.username&#125;<span class="tag">&lt;/<span class="name">user</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">locations</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">location</span>&gt;</span>filesystem:src/main/resources/db/migration<span class="tag">&lt;/<span class="name">location</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">locations</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong><em>jooq的maven配置</em></strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Use org.jooq            for the Open Source Edition</span></span><br><span class="line"><span class="comment">             org.jooq.pro        for commercial editions, </span></span><br><span class="line"><span class="comment">             org.jooq.pro-java-6 for commercial editions with Java 6 support,</span></span><br><span class="line"><span class="comment">             org.jooq.trial      for the free trial edition </span></span><br><span class="line"><span class="comment">             </span></span><br><span class="line"><span class="comment">         <span class="doctag">Note:</span> Only the Open Source Edition is hosted on Maven Central. </span></span><br><span class="line"><span class="comment">               Import the others manually from your distribution --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.jooq<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jooq-codegen-maven<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;org.jooq.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- The jOOQ code generation plugin is also executed in the generate-sources phase, prior to compilation --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">phase</span>&gt;</span>generate-sources<span class="tag">&lt;/<span class="name">phase</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">goal</span>&gt;</span>generate<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- This is a minimal working configuration. See the manual's section about the code generator for more details --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">jdbc</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">url</span>&gt;</span>$&#123;db.url&#125;<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">user</span>&gt;</span>$&#123;db.username&#125;<span class="tag">&lt;/<span class="name">user</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">jdbc</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">generator</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">database</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">includes</span>&gt;</span>.*<span class="tag">&lt;/<span class="name">includes</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">inputSchema</span>&gt;</span>FLYWAY_TEST<span class="tag">&lt;/<span class="name">inputSchema</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">database</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">target</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">packageName</span>&gt;</span>org.jooq.example.flyway.db.h2<span class="tag">&lt;/<span class="name">packageName</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">directory</span>&gt;</span>target/generated-sources/jooq-h2<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">target</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">generator</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="数据库增量"><a href="#数据库增量" class="headerlink" title="数据库增量"></a>数据库增量</h2><p>当我们开始开发我们的数据库时。为此，我们将创建数据库增量脚本，我们将其放入<code>src/main/resources/db/migration</code>目录中，如之前为Flyway插件配置的那样。我们将添加这些文件：</p>
<ul>
<li>V1__initialise_database.sql</li>
<li>V2__create_author_table.sql</li>
<li>V3__create_book_table_and_records.sql</li>
</ul>
<p>这三个脚本模拟我们的模式版本1-3（注意大写V！）。这是脚本的内容</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- V1__initialise_database.sql</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">SCHEMA</span> flyway_test <span class="keyword">IF</span> <span class="keyword">EXISTS</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">SCHEMA</span> flyway_test;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- V2__create_author_table.sql</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">SEQUENCE</span> flyway_test.s_author_id <span class="keyword">START</span> <span class="keyword">WITH</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> flyway_test.author (</span><br><span class="line">  <span class="keyword">id</span> <span class="built_in">INT</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  first_name <span class="built_in">VARCHAR</span>(<span class="number">50</span>),</span><br><span class="line">  last_name <span class="built_in">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  date_of_birth <span class="built_in">DATE</span>,</span><br><span class="line">  year_of_birth <span class="built_in">INT</span>,</span><br><span class="line">  address <span class="built_in">VARCHAR</span>(<span class="number">50</span>),</span><br><span class="line"></span><br><span class="line">  <span class="keyword">CONSTRAINT</span> pk_author PRIMARY <span class="keyword">KEY</span> (<span class="keyword">ID</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- V3__create_book_table_and_records.sql</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> flyway_test.book (</span><br><span class="line">  <span class="keyword">id</span> <span class="built_in">INT</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  author_id <span class="built_in">INT</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  title <span class="built_in">VARCHAR</span>(<span class="number">400</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line"></span><br><span class="line">  <span class="keyword">CONSTRAINT</span> pk_book PRIMARY <span class="keyword">KEY</span> (<span class="keyword">id</span>),</span><br><span class="line">  <span class="keyword">CONSTRAINT</span> fk_book_author_id <span class="keyword">FOREIGN</span> <span class="keyword">KEY</span> (author_id) <span class="keyword">REFERENCES</span> flyway_test.author(<span class="keyword">id</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> flyway_test.author <span class="keyword">VALUES</span> (<span class="keyword">next</span> <span class="keyword">value</span> <span class="keyword">for</span> flyway_test.s_author_id, <span class="string">'George'</span>, <span class="string">'Orwell'</span>, <span class="string">'1903-06-25'</span>, <span class="number">1903</span>, <span class="literal">null</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> flyway_test.author <span class="keyword">VALUES</span> (<span class="keyword">next</span> <span class="keyword">value</span> <span class="keyword">for</span> flyway_test.s_author_id, <span class="string">'Paulo'</span>, <span class="string">'Coelho'</span>, <span class="string">'1947-08-24'</span>, <span class="number">1947</span>, <span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> flyway_test.book <span class="keyword">VALUES</span> (<span class="number">1</span>, <span class="number">1</span>, <span class="string">'1984'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> flyway_test.book <span class="keyword">VALUES</span> (<span class="number">2</span>, <span class="number">1</span>, <span class="string">'Animal Farm'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> flyway_test.book <span class="keyword">VALUES</span> (<span class="number">3</span>, <span class="number">2</span>, <span class="string">'O Alquimista'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> flyway_test.book <span class="keyword">VALUES</span> (<span class="number">4</span>, <span class="number">2</span>, <span class="string">'Brida'</span>);</span><br></pre></td></tr></table></figure>

<h2 id="数据库迁移与代码生成"><a href="#数据库迁移与代码生成" class="headerlink" title="数据库迁移与代码生成"></a>数据库迁移与代码生成</h2><p>以上的三个脚本会由Flyway选取并按照版本顺序执行。执行命令</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn clean install</span><br></pre></td></tr></table></figure>

<p>之后观察log from flyway</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[INFO] --- flyway-maven-plugin:<span class="number">3.0</span>:migrate (<span class="keyword">default</span>) @ jooq-flyway-example ---</span><br><span class="line">[INFO] Database: jdbc:h2:~/flyway-test (H2 <span class="number">1.4</span>)</span><br><span class="line">[INFO] Validated <span class="number">3</span> migrations (execution time <span class="number">00</span>:<span class="number">00.004</span>s)</span><br><span class="line">[INFO] Creating Metadata table: <span class="string">"PUBLIC"</span>.<span class="string">"schema_version"</span></span><br><span class="line">[INFO] Current version of schema <span class="string">"PUBLIC"</span>: &lt;&lt; Empty Schema &gt;&gt;</span><br><span class="line">[INFO] Migrating schema <span class="string">"PUBLIC"</span> to version <span class="number">1</span></span><br><span class="line">[INFO] Migrating schema <span class="string">"PUBLIC"</span> to version <span class="number">2</span></span><br><span class="line">[INFO] Migrating schema <span class="string">"PUBLIC"</span> to version <span class="number">3</span></span><br><span class="line">[INFO] Successfully applied <span class="number">3</span> migrations to schema <span class="string">"PUBLIC"</span> (execution time <span class="number">00</span>:<span class="number">00.073</span>s).</span><br></pre></td></tr></table></figure>

<p>jooq log</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[INFO] --- jooq-codegen-maven:3.10.8:generate (default) @ jooq-flyway-example ---</span><br><span class="line">[INFO] --- jooq-codegen-maven:3.10.8:generate (default) @ jooq-flyway-example ---</span><br><span class="line">[INFO] Using this configuration:</span><br><span class="line">...</span><br><span class="line">[INFO] Generating schemata      : Total: 1</span><br><span class="line">[INFO] Generating schema        : FlywayTest.java</span><br><span class="line">[INFO] ----------------------------------------------------------</span><br><span class="line">[....]</span><br><span class="line">[INFO] GENERATION FINISHED!     : Total: 337.576ms, +4.299ms</span><br></pre></td></tr></table></figure>

<h2 id="发展"><a href="#发展" class="headerlink" title="发展"></a>发展</h2><p>每当有人向Maven模块添加新的迁移脚本时，所有前面的步骤都会自动执行。例如，团队成员可能已经提交了一个新的迁移脚本，您可以将其检出，重建并获取最新的jOOQ生成的源，以用于您自己的开发或集成测试数据库。</p>
<p>现在，完成这些步骤后，您可以继续编写数据库查询。想象一下以下测试用例</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.jooq.Result;</span><br><span class="line"><span class="keyword">import</span> org.jooq.impl.DSL;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.sql.DriverManager;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> java.util.Arrays.asList;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.jooq.example.flyway.db.h2.Tables.*;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.junit.Assert.assertEquals;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AfterMigrationTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testQueryingAfterMigration</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> (Connection c = DriverManager.getConnection(<span class="string">"jdbc:h2:~/flyway-test"</span>, <span class="string">"sa"</span>, <span class="string">""</span>)) &#123;</span><br><span class="line">            Result&lt;?&gt; result =</span><br><span class="line">            DSL.using(c)</span><br><span class="line">               .select(</span><br><span class="line">                   AUTHOR.FIRST_NAME,</span><br><span class="line">                   AUTHOR.LAST_NAME,</span><br><span class="line">                   BOOK.ID,</span><br><span class="line">                   BOOK.TITLE</span><br><span class="line">               )</span><br><span class="line">               .from(AUTHOR)</span><br><span class="line">               .join(BOOK)</span><br><span class="line">               .on(AUTHOR.ID.eq(BOOK.AUTHOR_ID))</span><br><span class="line">               .orderBy(BOOK.ID.asc())</span><br><span class="line">               .fetch();</span><br><span class="line"></span><br><span class="line">            assertEquals(<span class="number">4</span>, result.size());</span><br><span class="line">            assertEquals(asList(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>), result.getValues(BOOK.ID));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="SQL构建"><a href="#SQL构建" class="headerlink" title="SQL构建"></a>SQL构建</h1><p><a href="https://www.jooq.org/doc/3.10/manual/sql-building/" target="_blank" rel="noopener">https://www.jooq.org/doc/3.10/manual/sql-building/</a></p>
<h2 id="查询DSL类型"><a href="#查询DSL类型" class="headerlink" title="查询DSL类型"></a>查询DSL类型</h2><p>JOOQ暴露了许多接口，并隐藏了客户端代码的大多数实现，原因是</p>
<ul>
<li>接口驱动设计，允许最有效地在流畅的API中建模查询</li>
<li>降低客户端代码的复杂性</li>
<li>API保证，只依赖于公开的接口，而不是具体的实现。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.jooq.impl.DSL.*;</span><br></pre></td></tr></table></figure>

<p><strong><em>DSL子类</em></strong></p>
<p>每种SQL方言都有自己的方言专用DSL，如只使用MySQL方言，则可以选择引用MySQLDSL而不是标准DSL</p>
<h2 id="DSLContext类"><a href="#DSLContext类" class="headerlink" title="DSLContext类"></a>DSLContext类</h2><p><strong><em>创建</em></strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Create it from a pre-existing configuration，从预先的配置中创建</span></span><br><span class="line">DSLContext create = DSL.using(configuration);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create it from ad-hoc arguments，从ad-hoc参数创建</span></span><br><span class="line">DSLContext create = DSL.using(connection, dialect);</span><br></pre></td></tr></table></figure>

<p><strong><em>配置</em></strong></p>
<p>可以为这些对象提供配置：</p>
<ul>
<li><a href="https://www.jooq.org/javadoc/3.10.x/org/jooq/SQLDialect.html" target="_blank" rel="noopener">org.jooq.SQLDialect</a>：数据库的方言。这可能是任何当前支持的数据库类型（有关详细信息，请参阅<a href="https://www.jooq.org/doc/3.10/manual/sql-building/dsl-context/sql-dialects/" target="_blank" rel="noopener">SQL Dialect</a>）</li>
<li><a href="https://www.jooq.org/javadoc/3.10.x/org/jooq/conf/Settings.html" target="_blank" rel="noopener">org.jooq.conf.Settings</a>：可选的运行时配置（有关详细信息，请参阅<a href="https://www.jooq.org/doc/3.10/manual/sql-building/dsl-context/custom-settings/" target="_blank" rel="noopener">自定义设置</a>）</li>
<li><a href="https://www.jooq.org/javadoc/3.10.x/org/jooq/ExecuteListenerProvider.html" target="_blank" rel="noopener">org.jooq.ExecuteListenerProvider</a>：对可以为jOOQ提供执行侦听器的提供程序类的可选引用（有关详细信息，请参阅<a href="https://www.jooq.org/doc/3.10/manual/sql-execution/execute-listeners/" target="_blank" rel="noopener">ExecuteListeners</a>）</li>
<li><a href="https://www.jooq.org/javadoc/3.10.x/org/jooq/RecordMapperProvider.html" target="_blank" rel="noopener">org.jooq.RecordMapperProvider</a>：对可以为jOOQ提供记录映射器的提供者类的可选引用（有关详细信息，请参阅<a href="https://www.jooq.org/doc/3.10/manual/sql-execution/fetching/pojos-with-recordmapper-provider/" target="_blank" rel="noopener">带有RecordMappers的POJO</a>）</li>
<li>任何这些：<ul>
<li><a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.sql/java/sql/Connection.html" target="_blank" rel="noopener">java.sql.Connection</a>：可选的JDBC连接，将在配置的整个生命周期中重复使用（有关详细信息，请参阅<a href="https://www.jooq.org/doc/3.10/manual/sql-building/dsl-context/connection-vs-datasource/" target="_blank" rel="noopener">连接与数据源</a>）。为简单起见，这是本手册中引用的用例，大部分时间都是如此。</li>
<li><a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.sql/java/sql/DataSource.html" target="_blank" rel="noopener">java.sql.DataSource</a>：一个可选的JDBC DataSource，它将在Configuration的整个生命周期中重用。如果您更喜欢在Connections上使用DataSources，jOOQ将在内部从您的DataSource获取新的Connections，在查询执行后方便地再次关闭它们。这在J2EE或Spring上下文中特别有用（有关详细信息，请参阅<a href="https://www.jooq.org/doc/3.10/manual/sql-building/dsl-context/connection-vs-datasource/" target="_blank" rel="noopener">Connection与DataSource</a>）</li>
<li><a href="https://www.jooq.org/javadoc/3.10.x/org/jooq/ConnectionProvider.html" target="_blank" rel="noopener">org.jooq.ConnectionProvider</a>：jOOQ用于“获取”和“释放”连接的自定义抽象。jOOQ将在内部“获取”来自ConnectionProvider的新连接，在查询执行后方便地“释放”它们。（有关详细信息，请参阅<a href="https://www.jooq.org/doc/3.10/manual/sql-building/dsl-context/connection-vs-datasource/" target="_blank" rel="noopener">Connection vs. DataSource</a>）</li>
</ul>
</li>
</ul>
<h2 id="SQL语句（DML）"><a href="#SQL语句（DML）" class="headerlink" title="SQL语句（DML）"></a>SQL语句（DML）</h2><h2 id="SQL语句（DDL）"><a href="#SQL语句（DDL）" class="headerlink" title="SQL语句（DDL）"></a>SQL语句（DDL）</h2><h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ol>
<li></li>
</ol>

          
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
    </footer>
  </div>
  
  
  
  </article>

    
      

  <article class="post post-type-tags" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/07/06/计算机网络/计算机网络：概述/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Heper">
      <meta itemprop="description" content="To be awesome">
      <meta itemprop="image" content="/images/head.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">

        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/07/06/计算机网络/计算机网络：概述/" class="post-title-link" itemprop="url">计算机网络：概述</a>
              
            
          </h1>
        

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              

              
                
              

              <time title="Erstellt: 2019-07-06 21:52:14" itemprop="dateCreated datePublished" datetime="2019-07-06T21:52:14+08:00">2019-07-06</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Bearbeitet am</span>
                
                <time title="Geändert am: 2019-07-18 14:49:34" itemprop="dateModified" datetime="2019-07-18T14:49:34+08:00">2019-07-18</time>
              </span>
            
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">in</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/计算机网络/" itemprop="url" rel="index"><span itemprop="name">计算机网络</span></a></span>

                
                
              
            </span>
          

          
            <span id="/2019/07/06/计算机网络/计算机网络：概述/" class="post-meta-item leancloud_visitors" data-flag-title="计算机网络：概述">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">Aufrufe: </span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          
            
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="fa fa-comment-o"></i>
    </span>
    
      <span class="post-meta-item-text">Kommentare: </span>
    
  
    <a href="/2019/07/06/计算机网络/计算机网络：概述/#comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2019/07/06/计算机网络/计算机网络：概述/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
          <br>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
            <h1 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h1><p>因特网目前具有着数以亿计的相连的计算机、通信链路和交换机。</p>
<p>面对如此巨大并且具有如此众多不同组件和用户的因特网，是否能够理解其工作原理。其是否存在某些指导原则和结构，能够作为理解规模和复杂程度惊人的系统的基础。</p>
<h1 id="什么是因特网"><a href="#什么是因特网" class="headerlink" title="什么是因特网"></a>什么是因特网</h1><ul>
<li>以因特网的具体构成来描述，即构成因特网的基本硬件和软件组件</li>
<li>根据为分布式应用提供服务的联网基础设施描述因特网</li>
</ul>
<h2 id="具体构成描述"><a href="#具体构成描述" class="headerlink" title="具体构成描述"></a>具体构成描述</h2><p>以因特网的角度来看，所有接入网络的设备都称为主机或<strong>端系统</strong>。</p>
<h3 id="端系统间的通信"><a href="#端系统间的通信" class="headerlink" title="端系统间的通信"></a>端系统间的通信</h3><p>端系统通过<strong>通信链路</strong>和<strong>分组交换机</strong>连接到一起。当一台端系统要向另一台端系统发送数据时，发送端系统将数据分段，并为每段加上首部字节，由此形成的信息包称为<strong>分组</strong>，分组通过网络发送到目的端系统，在那里装配成初始数据。</p>
<h3 id="分组交换机的工作"><a href="#分组交换机的工作" class="headerlink" title="分组交换机的工作"></a>分组交换机的工作</h3><p>分组交换机从它的一条入通信链路接受到达的分组，并从它的一条出通信链路转发该分组。</p>
<p><strong>分类</strong></p>
<ul>
<li>路由器。位于网络层，通常用于网络核心中。</li>
<li>链路层交换机。位于链路层，通常用于接入网中。</li>
</ul>
<p><strong><em>网络路径</em></strong></p>
<p>在发送端到接收端，一个分组所经历的一系列通信链路和分组交换机称为通过该网络的<strong>路径</strong>。</p>
<p><strong><em>总结</em></strong></p>
<p>分组交换网络很类似于承载运输车辆的运输网络，包括着高速公路、公路和立交桥。分组即是卡车，通信链路类似于高速公路与公路，而分组交换机类似于立交桥，端系统就像是建筑物。因此就像卡车寻找目的地意义，分组选取网络中一条路径前行</p>
<h3 id="ISP（接入因特网）"><a href="#ISP（接入因特网）" class="headerlink" title="ISP（接入因特网）"></a>ISP（接入因特网）</h3><p>端系统通过因特网服务提供商（<strong>ISP</strong>）接入因特网。包括了住宅区ISP、公司ISP、学校ISP、WIFI接入的ISP。</p>
<p>每个ISP是一个由多个分组交换机和多段通信链路组成的网络。</p>
<p>各ISP为端系统提供了各种不同类型的网络接入。包括有线接入、高速局域网接入、无线接入等等。ISP也为内容提供者提供因特网接入服务，将Web站点直接接入因特网。</p>
<p><strong><em>ISP互联</em></strong></p>
<p>因特网就是将端系统彼此关联，因此为端系统提供接入服务的ISP也必须互联。底层的ISP通过国家的高层ISP互联起来，高层ISP由高速的路由器组成。每个ISP都是独立管理，运行着IP协议 。</p>
<h3 id="协议"><a href="#协议" class="headerlink" title="协议"></a>协议</h3><p>端系统、分组交换机和其他因特网部件都要运行一系列的协议，<strong>控制因特网中信息的接受和发送</strong>。</p>
<p>IP协议定义了在端系统和路由器之间发送和接收的分组格式</p>
<h2 id="服务描述"><a href="#服务描述" class="headerlink" title="服务描述"></a>服务描述</h2><p>从应用程序提供服务的基础设施的角度描述因特网</p>
<p><strong>分布式应用程序</strong>：涉及到多台互相交换数据的端系统。如社交网络等。</p>
<p>为使得运行在一个端系统上的应用程序向因特网上运行在另一个端系统上的软件发送消息。与因特网相连的端系统提供了一个应用程序编程接口API（类似于邮政服务），规定了运行在一个端系统上的软件请求因特网基础设施向运行在另一个端系统上特定目的地软件交付数据的方式。</p>
<h2 id="协议-1"><a href="#协议-1" class="headerlink" title="协议"></a>协议</h2><p>何为协议，协议是做什么的。</p>
<h3 id="网络协议"><a href="#网络协议" class="headerlink" title="网络协议"></a>网络协议</h3><blockquote>
<p>一个协议定义了在两个或多个通信实体之间交换的报文格式和次序，以及报文发送和/或接收一条报文或其他事件所采取的动作。</p>
</blockquote>
<p>交换报文和采取动作的实体是某些设备的硬件或软件组件，是具有网络能力的设备。</p>
<p>在因特网当中，凡是涉及两个或多个远程通信实体的所有活动都受到协议的制约。</p>
<p>在两台物理上连接的计算机中，硬件实现的协议控制了在两块网络接口卡间的“线上”的比特流。在端系统中，拥塞控制协议控制了在发送端和接收方间的传输的分组发送的速率。</p>
<h1 id="网络边缘"><a href="#网络边缘" class="headerlink" title="网络边缘"></a>网络边缘</h1><p>在此处，进行深入探究计算机网络的部件。从网络边缘开始观察部件。如计算机、手机等，从边缘向核心推进。</p>
<p>主机或者说端系统，可以分为两类</p>
<ul>
<li>客户</li>
<li>服务器。服务器用于存储和发布web页面等。</li>
</ul>
<h2 id="接入网"><a href="#接入网" class="headerlink" title="接入网"></a>接入网</h2><p>接入网，即将端系统连接到其<strong>边缘路由器</strong>的物理链路。边缘路由器是端系统到任何其他远程端系统的路径上的第一台路由器。</p>
<h3 id="家庭接入"><a href="#家庭接入" class="headerlink" title="家庭接入"></a>家庭接入</h3><p>接入方式有DSL、电缆、FTTH、拨号、卫星。DSL（数字用户线）和电缆是当下最流行的方式。</p>
<p><strong><em>DSL接入</em></strong></p>
<p>用户通常从提供电话接入获得DSL接入，使用DSL时，本地电话公司也是它的ISP。每个用户的DSL调制解调器使用现有的电话线（双绞铜线）与位于本地电话公司的本地中心局中的数字用户线接入复用器（DSLAM）来交换数据。家庭的DSL调制解调器得到数字数据后将其转换为高频音，以通过电话线传输给本地中心局。即模拟信号在DSLAM处被转换回数字形式。</p>
<p><img src="assets/1562463535138.png" alt="1562463535138"></p>
<p>家庭电话线同时承载了数据和传统的电话信号，它们编码位不同的频率。这种方式下，单根的DSL线路如同三根线路，使得一个电话与一个因特网连接同时共享DSL链路（<strong>频分复用</strong>）</p>
<ul>
<li>高速下行信道，50KHZ到1MHZ</li>
<li>中速上行信道，4KHZ到50KHZ</li>
<li>普通的双向电话信道，0到4KHZ</li>
</ul>
<p>在用户侧，分频器将到达家庭的数据信号和电话信号分隔，将数据信号转发给DSL调制解调器。在本地电话公司侧，DSLAM将数据和电话信号分割开，并将数据送往因特网。</p>
<p><strong><em>电缆接入</em></strong></p>
<p>利用了有线电视公司现有的有线电视基础设施。在该系统当中应用了光纤和同轴电缆，因此也被称为<strong>混合光纤同轴</strong><img src="assets/1562464984037.png" alt="1562464984037"></p>
<p>电缆因特网接入需要特殊的调整解调器，称为<strong>电缆调制解调器</strong>。通常是一个外部设备，以一个以太网端口接入家庭。</p>
<p>在电缆头部，电缆调制解调器端接系统（CMTS）起到如同DSL网络的DSLAM类似的功能，将来自许多下行家庭中的电缆调制解调器发送的模拟信号转回数字形式。</p>
<p>电缆因特网接入的一个重要特征是<strong>共享广播媒体</strong>。特别是由头端发送的每个分组向下行经每段链路到每个家庭；每个家庭发送的每个分组经上行信道向头端传输。</p>
<ul>
<li>因此若几个用户同时经下行信道下载一个视频文件，每个用户接收的实际速率将大大低于电缆总计的下行速率</li>
<li>若仅仅有很少的用户在web上，则每个用户都可以以下行速率的全部接收web网页</li>
</ul>
<p>因为上行信道也是共享的，需要一个分布式多路访问协议来协调传输和避免碰撞</p>
<p><strong><em>光纤到户FTTH</em></strong></p>
<p>从本地中心局直接到家庭提供一条光纤路径。光纤分布体系结构有：<strong>主动光纤网络AON</strong>和<strong>被动光纤网络PON</strong></p>
<p>AON基本上就是交换因特网。PON的FTTH结构如下</p>
<p><img src="assets/1562466253569.png" alt="1562466253569"></p>
<h3 id="企业和家庭接入"><a href="#企业和家庭接入" class="headerlink" title="企业和家庭接入"></a>企业和家庭接入</h3><p><strong><em>以太网</em></strong></p>
<p>在公司和大学校园以及家庭当中，通常是使用局域网（LAN）将端用户连接到边缘路由器。以太网是目前为止最为流行的接入技术。以太网用户使用双绞铜线与一台以太网交换机相连，以太网交换机再与更大的因特网相连。</p>
<p>在该接入下，用户通常以100mbps速率接入交换机，而服务器可能具有1Gbps甚至10Gbps</p>
<p><img src="assets/1562466633094.png" alt="1562466633094"></p>
<p><strong><em>WIFI</em></strong></p>
<p>在智能手机的加入后，若是使用无线LAN接入，用户从一个接入点发送/接收分组，该接入点与企业网相连，该企业网再与有线因特网相连。一个无线LAN用户需要在<strong>接入网几十米范围</strong>内。</p>
<p><strong><em>WIFI+宽带</em></strong></p>
<p>将DSL或电缆调制解调器与WIFI结合起来。组成有：漫游的便携机、有线PC、与无线通信的基站（无线接入点）、提供与因特网宽带接入的电缆调整解调器、互联了基站以及带有电缆调制解调器的固定PC的路由器</p>
<p>该网络允许家庭成员经过宽带接入因特网，可以在各个位置漫游上网。</p>
<p><img src="assets/1562469920832.png" alt="1562469920832"></p>
<h3 id="广域无线接入"><a href="#广域无线接入" class="headerlink" title="广域无线接入"></a>广域无线接入</h3><p><strong><em>3G</em></strong></p>
<p>应用了与移动电话相同的基础设施，通过蜂窝网提供商运营的基站发送接收分组。一个用户只需要在基站数万米内即可。</p>
<h2 id="物理媒体"><a href="#物理媒体" class="headerlink" title="物理媒体"></a>物理媒体</h2><p>HFC使用了光缆和同轴电缆相结合的技术；DSL和以太网使用了双绞铜线；移动接入网使用了无线电频谱。</p>
<p>考虑一个比特的短暂历程。</p>
<ul>
<li>一个比特从一个端系统开始传输，经过一系列链路和路由器，到达另一个端系统。</li>
<li>这个比特被传输许多多此，源端系统首先传输这个比特，之后一台路由器接收、传输该比特，由路由器进行转发传输。</li>
<li>通过一系列的“传输-接收器”，它们通过跨越一种物理媒体传输电磁波或光脉冲来发送该比特。<ul>
<li>该物理媒体可以有多重形状和形式。对于传输-接收器也不必具有相同的类型</li>
</ul>
</li>
</ul>
<p>物理媒体划分为<strong>两类</strong>：导引型媒体与非导引型媒体。</p>
<ul>
<li>导引型：电波沿着固体媒体前行，如光缆、双绞铜线或同轴电缆</li>
<li>非导引型媒体：电波在空气或外层空间中传输，如无线局域网或数字卫星频道</li>
</ul>
<h3 id="双绞铜线"><a href="#双绞铜线" class="headerlink" title="双绞铜线"></a>双绞铜线</h3><h3 id="同轴电缆"><a href="#同轴电缆" class="headerlink" title="同轴电缆"></a>同轴电缆</h3><h3 id="光纤"><a href="#光纤" class="headerlink" title="光纤"></a>光纤</h3><h3 id="陆地无线电信道"><a href="#陆地无线电信道" class="headerlink" title="陆地无线电信道"></a>陆地无线电信道</h3><h3 id="微信无线电信道"><a href="#微信无线电信道" class="headerlink" title="微信无线电信道"></a>微信无线电信道</h3><h1 id="网络核心"><a href="#网络核心" class="headerlink" title="网络核心"></a>网络核心</h1><p>深入研究网络的核心，即由互联网因特网端系统的分组交换机和链路构成的网状网络。</p>
<p>通过网络链路和交换机移动数据有两种基本方式：电路交换和分组交换。</p>
<h2 id="分组交换"><a href="#分组交换" class="headerlink" title="分组交换"></a>分组交换</h2><p>端系统彼此交换报文。报文能够包含协议设计者需要的任何东西。报文可以执行一种控制功能，也可以包含数据。</p>
<p>为了从源端系统向目的端系统发送一个报文，源将长报文划分为较小的数据块，称为<strong>分组</strong>，每个分组都通过通信链路和分组交换机（路由器与链路层交换机）传送。分组以<strong>等于该链路最大传输速率的速度</strong>传输通过通信链路。</p>
<h3 id="存储转发传输"><a href="#存储转发传输" class="headerlink" title="存储转发传输"></a>存储转发传输</h3><p>多数的分组交换机在链路的输入端使用存储转发传输机制。存储转发机制是指交换机能够开始向输出链路传输该分组的第一个比特前，必须接收到整个分组。</p>
<p><strong><em>举例</em></strong></p>
<p>考虑由两个经一台路由器连接的端系统。</p>
<p><img src="assets/1562476348428.png" alt="1562476348428"></p>
<p>路由器将分组从一条输入链路转移到另一条唯一的连接链路。当分组1的前沿到达路由器时，由于路由器使用存储转发机制，此时还不能将传输已经接收的比特，而是必须先缓存该分组的比特。当路由器已经接收完了该分组的所有比特后，才能向出链路转发该分组。</p>
<p>当源在时刻0进行传输，则在时刻L/R秒（L：分组的比特数，R：链路的传输速率，是将所有分组比特推向链路所需要的时间），路由器刚好接收到整个分组，此时可以进行转发。在时刻2L/R秒，路由器已经传输了整个分组，并被目的地接收。因此总时延是2L/R。若交换机不必进行存储转发，则总时延是L/R。实际的发送时延通常在毫秒到微秒级。</p>
<p><strong><em>端到端时延</em></strong></p>
<p>端到端的传输时延是d=NL/R（N为链路数目，中间有N-1台路由器）</p>
<h3 id="排队时延和分组丢失"><a href="#排队时延和分组丢失" class="headerlink" title="排队时延和分组丢失"></a>排队时延和分组丢失</h3><p>每个分组交换机有一个输出缓存（输出队列），用于存储路由器准备发往哪条链路的分组。如果到达的分组需要传输到某条链路，但发现该链路正忙于传输其他分组，该到达分组必须在输出缓存中等待，因此分组还要承受输出缓存的<strong>排队时延</strong>。</p>
<p>排队时延是变化的，程度取决于网络中的拥塞程度。</p>
<p><strong>分组丢失</strong>：由于缓存空间的大小有限，一个到达的分组可能发现该缓存已经被其他等待传输的分组完全充满了，在此情况下会出现丢包。到达的分组或已经排队的分组之一被丢弃</p>
<h3 id="转发表和路由选择协议"><a href="#转发表和路由选择协议" class="headerlink" title="转发表和路由选择协议"></a>转发表和路由选择协议</h3><p>路由器从与它相连的一条通信链路获得分组，将其向与它相连的另一条通信链路转发。但是路由器如何决定它应该向哪条链路进行转发呢？不同的额计算机网络以不同的方式完成的</p>
<p>因特网中，每个端系统当中具有一个称为IP地址的地址。当源主机向目的端系统发送一个分组时，源在该分组的首部包含了目的地的IP地址。</p>
<p><strong><em>根据IP地址进行转发</em></strong></p>
<p>IP地址具有等级结构，当一个分组到达网络中的路由器时，路由器检查该分组的目的地址的一部分，并向一台相邻路由器转发该分组。路由器有一个<strong>转发表</strong>用于映射目的地址（或目的地址的一部分）到    输出链路。</p>
<p><strong><em>转发表是如何设置的呢</em></strong></p>
<p>因特网具有一些特殊的路由选择协议，用于自动地设置这些转发表。</p>
<h2 id="电路交换"><a href="#电路交换" class="headerlink" title="电路交换"></a>电路交换</h2><p>电路交换网络中，在端系统间通信会话期间，预留了端系统间通信沿路径所需要的资源（缓存、链路传输速率）。会话的报文按需使用这些资源，其后果可能是不得不等待接入通信线路。</p>
<p>传统的电话网络是电路交换网络的实例，当一个人通过电话网向另一个人发送信息时，在发送方能够发送信息前，该网络必须在发送方和接收方建立一条连接，路径上的交换机都会为该连接维护连接状态。该连接被称为一条<strong>电路</strong>。</p>
<p>当网络创建这种电路时，也在该连接期间在该网络链路上预留了恒定的传输速率，即发送方能够以确保的恒定速率向发送方传送数据。</p>
<h3 id="电路交换网络中的复用"><a href="#电路交换网络中的复用" class="headerlink" title="电路交换网络中的复用"></a>电路交换网络中的复用</h3><p><strong><em>频分复用FDM</em></strong></p>
<p>链路的频谱由跨越链路创建创建的所有连接所共享。在连接期间，链路为每条连接专用一个频段。在电话网络中该频段通常具有4kHZ的带宽，该频段的宽度称为<strong>带宽</strong>。调频无线电台使用FDM共享88-108kHZ的频谱，每个电台被分配一个特定的频段。</p>
<p><strong><em>时分复用TDM</em></strong></p>
<p>时间被划分为固定的帧，每帧被划分为固定的时隙，当网络跨越一条链路创建一条连接时，网络在每个帧内为该连接指定一个时隙。这些时隙专门由该连接单独使用。</p>
<h3 id="分组交换与电路交换对比"><a href="#分组交换与电路交换对比" class="headerlink" title="分组交换与电路交换对比"></a>分组交换与电路交换对比</h3><ul>
<li>分组交换不适合实时服务（电话等），因为它的端到端时延是可变而不可预测的。（排队时延的变动）</li>
<li>分组交换提供了比电路交换更好地带宽共享</li>
<li>分组交换比电路交换更简单、更有效、成本更低。</li>
</ul>
<p><strong><em>分组交换为何更加有效</em></strong></p>
<p>假设</p>
<ul>
<li>当多个用户共享一条1Mbps的链路，假定用户活跃周期是变化的</li>
<li>某用户以100kps恒定速率产生数据，时而静止。</li>
<li>假定用户有10%时间活跃。</li>
</ul>
<p><strong><em>电路交换</em></strong></p>
<p>对于电路交换，在所有的时间内必须为每个用户预留100kbps。因此该电路交换链路只能支撑10个并发用户。</p>
<p><strong><em>分组交换</em></strong></p>
<p>对于分组交换，一个用户的活跃概率为10%，若有35个用户，则存在11个或更多个活跃用户的概率大约是0.0004，当存在10个以下时，到达的聚合数据率小于输出速率1Mbps，因此基本没有时延，与电路交换一致。</p>
<p>当活跃用户超过10人，则输出队列开始变长，直到聚合输入率小于输出率。由于概率较低，因此总是提供了电路交换相同的性能</p>
<p><strong><em>情境2</em></strong></p>
<p>有10个用户，每个用户突然产生1000个1000比特的分组，其他用户静默。</p>
<p>在电路交换中，若有10个时隙，则只有一个时隙用来传输数据。而在分组交换下，活跃用户能够连续以1Mbps速度进行发送数据。</p>
<p><strong><em>总结</em></strong></p>
<p>因此在相同较少人数的时候，分组交换与电路交换的性能一致；在人数很少时，分组交换的性能远超电路交换；在人数较多时，电路交换只能等待，而分组交换依然可用，只是存在延迟。                    </p>
<h2 id="网络的网络"><a href="#网络的网络" class="headerlink" title="网络的网络"></a>网络的网络</h2><p>端系统通过接入ISP与因特网相连，但为端用户和内容提供商提供和接入ISP仅解决了连接难题中的很小一部分，因为因特网是由数以亿计的用户构成的。因此接入ISP自身必须互联。通过创建<strong>网络的网络</strong>可以做到这一点。</p>
<p>为了能够使得所有端系统都能够彼此发送分组。较为幼稚的做法是接入ISP直接与其他ISP连接，但是成本太高。</p>
<h3 id="网络结构1"><a href="#网络结构1" class="headerlink" title="网络结构1"></a>网络结构1</h3><p>用单一的全球承载ISP互联所有接入ISP，假象的全球承载ISP是一个由路由器和通信链路构成的网络，该网络至少具有一个路由器靠近数十万接入ISP中的每一个。为了有利可图，接入ISP被认为是客户，全球承载ISP被认为是提供商</p>
<h3 id="网络结构2"><a href="#网络结构2" class="headerlink" title="网络结构2"></a>网络结构2</h3><p>若某个公司建立并运行了一个可盈利的全球承载ISP，其他公司建立自己的全球承载ISP并与最初的全球承载ISP竞争。即 数十万接入ISP与多个全球承载ISP组成，并且这些全球承载ISP互联。</p>
<h3 id="网络结构3"><a href="#网络结构3" class="headerlink" title="网络结构3"></a>网络结构3</h3><p>在网络的第一层，有多个竞争的第一层ISP。在一个区域当中，有多个竞争的区域ISP。在某些区域当中，可能有较大的区域ISP（跨越国家），区域中较小的ISP与之相连等。</p>
<p>每个接入ISP向区域ISP支付连接费用，每个区域ISP向第一层ISP付费。</p>
<h3 id="网络结构4"><a href="#网络结构4" class="headerlink" title="网络结构4"></a>网络结构4</h3><p>为了建造一个与今天因特网更为相似的网络，需要在网络结构3的基础上增加存在点（POP）、多宿、对等和因特网交换点（IXP）。</p>
<p><strong><em>PoP</em></strong></p>
<p>PoP存在于等级结构中的所有层次，除底层（接入ISP）外，一个PoP只是提供商网络中的一台或多台（在相同位置）路由器群组，其中客户ISP能够与提供商ISP连接。对于要与提供商PoP连接的客户网络，能够从第三方通信提供商租用高速链路直接将它的路由器之一连到位于该PoP的一台路由器。</p>
<p><strong><em>多宿</em></strong></p>
<p>任何ISP（除接入ISP）可以选择为多宿，即与两个或更多提供商ISP连接，即使提供商之一出现故障，仍然可以接收和发送分组。</p>
<p><strong><em>对等</em></strong></p>
<p>客户ISP向它们的提供商ISP付费已获得全球因特网互联能力，客户ISP支付的费用反映了它的流量。为了减少费用，位于相同等级结构层次的临近一对ISP能够对等。即他们的网络可以直接相连，使得他们间所有流量经直接连接而不是通过上游的中间ISP传输</p>
<p>对等的ISP通常不进行结算，第三方公司创建一个<strong>因特网交换点（IXP）</strong>，多个ISP在这里共同对等。</p>
<h3 id="网络结构5"><a href="#网络结构5" class="headerlink" title="网络结构5"></a>网络结构5</h3><p>描述2012年的因特网</p>
<p><img src="assets/1562491411282.png" alt="1562491411282"></p>
<p>在网络结构4的顶部增加内容提供商网络构建而成。该网络仅仅承载出入其服务器主机的流量，并且尝试与较低层ISP对等尝试绕过较高层</p>
<h1 id="分组交换网中的时延、丢包和吞吐量"><a href="#分组交换网中的时延、丢包和吞吐量" class="headerlink" title="分组交换网中的时延、丢包和吞吐量"></a>分组交换网中的时延、丢包和吞吐量</h1><p>因特网能够看成是一种为运行在端系统上的分布式应用提供服务的基础设施。在理想情况下，我们希望因特网服务能够在任意两个端系统间瞬间移动我们想要的大量数据而没有任何数据丢失。但是这是一个极高的目标。</p>
<p>计算机网络必定要限制在端系统间的吞吐量，在端系统间引入时延，而且实际上能够丢失分组。</p>
<h2 id="分组交换网中的时延概述"><a href="#分组交换网中的时延概述" class="headerlink" title="分组交换网中的时延概述"></a>分组交换网中的时延概述</h2><p>分组从主机出发，经过一系列路由器传输，在目的地结束里程。在沿途每个结点经受了集中不同的时延，最为重要的有</p>
<ul>
<li>结点处理时延<ul>
<li>通常微不足道，但是对一台路由器的最大吞吐量有重要影响，是路由器能够转发分组的最大速率</li>
</ul>
</li>
<li>排队时延</li>
<li>传输时延<ul>
<li>对于LAN等可能微不足道，对于低速拨号调制解调器链路发送的长因特网分组而言是主要成分</li>
</ul>
</li>
<li>传播时延<ul>
<li>对于位于同一个大学的两台路由器间可能微不足道，但是对于同步卫星互联的来说可能是主要成分</li>
</ul>
</li>
</ul>
<p>它们的累加即是结点总时延。</p>
<h3 id="时延的类型"><a href="#时延的类型" class="headerlink" title="时延的类型"></a>时延的类型</h3><p>一个分组从上游结点通过路由器A向路由器B发送，路由器A具有通往路由器B的出链路。该链路前有一个队列。当该分组从上游结点到达路由器A时，路由器A检查该分组的首部以决定该分组的适当出链路，并将该分组导向该链路。</p>
<p>仅当该链路没有其他分组正在传输并且没有其他分组在前面排队时，才能在该链路上进行传输，否则要参与排队</p>
<p><img src="assets/1562598364024.png" alt="1562598364024"></p>
<p><strong><em>处理时延</em></strong></p>
<p>检查分组首部和决定将该分组导向何处所需要的时间是处理时延的一部分。处理时延也包含其他因素，如检查比特级别的差错所需要的时间</p>
<p><strong><em>排队时延</em></strong></p>
<p>在队列中，当分组在链路上等待传输时，经受排队时延。该时延与入流量与出流量有关</p>
<p><strong><em>传输(发送)时延</em></strong></p>
<p>用L比特表示该分组的长度，用Rbps表示从路由器A到B的传输速率。则传输时延是L/R。是一个收费站的概念</p>
<p><strong><em>传播时延</em></strong></p>
<p>一旦一个比特被推向链路，该比特需要向路由器B传播，从该链路的起点到路由器B传播所需要的时间就是传播时延。时延为d/s。是在高速公路上行驶的概念，但是速度非常快</p>
<h2 id="排队时延和丢包"><a href="#排队时延和丢包" class="headerlink" title="排队时延和丢包"></a>排队时延和丢包</h2><p>排队时延对于不同的分组时不同的，在一个队列当中，第一个为0，最后一个要承受相对大的排队时延。因此，在表征排队时延时，人们通常使用统计量测度，如平均排队时延、排队时延的方差和排队时延超过某些特定值的概率。</p>
<p>排队时延很大程度上取决于流量到达该队列的速率、链路的传输速率与到达流量的性质（流量是周期性到达还是突发形式到达）。</p>
<h3 id="流量强度"><a href="#流量强度" class="headerlink" title="流量强度"></a>流量强度</h3><p>令a表示分组到达队列的平均速率（a的单位是分组/s，即pkt/s）。R为传输速率，即从队列中推出比特的速率（b/s），假定所有分组都是L比特，则比特到达队列的平均速率为La bps，假定队列非常大，可以容纳无限数量的比特，<strong>速率La/R称为流量强度</strong>。</p>
<p>若La/R&gt;1则比特到达队列的平均速率超过从该队列传输出去的速率，此时队列将趋于无界增加。</p>
<p>考虑La/R&lt;=1，则到达流量的性质会影响排队时延。若分组周期到达，如L/R秒到达，则每个分组将到达一个空队列中。若是分组以突发形式到达，则有很大的平均排队时延。</p>
<p>当流量强度接近于1，将存在到达率超过传输能力的时间间隔，在这些时间内将形成队列，随着越接近1，则平均排队长度变得越来越长。即该强度少量的增加将导致时延大得多的增加。</p>
<h3 id="丢包"><a href="#丢包" class="headerlink" title="丢包"></a>丢包</h3><p>现实当中，从<strong>路由器角度</strong>看，一条链路的队列只有优先的容量，其极大依赖于路由器设计和成本。随着流量强度接近1，当到达的分组发现一个满的队列，则路由器会丢弃该分组。</p>
<p>从<strong>端系统</strong>角度看，一个分组已经传输到网络核心，但是它绝不会从网络发送到目的地，分组丢失的份额随着流量强度增加而增加。</p>
<p>因此一个结点的性能可以通过时延来度量，也可以通过分组丢失的概率来度量。</p>
<h2 id="端到端时延"><a href="#端到端时延" class="headerlink" title="端到端时延"></a>端到端时延</h2><p>考虑从源主机到目的地的总时延，假定源主机和目的主机之间有N-1台路由器，假设网络此时无堵塞（即排队时延忽略），在每台路由器和源主机上的处理时延是Dproc，每台路由器和源主机的输出速率是Rbps，即Dtrans=L(分组长度)/R，每条链路的传播时延是Dprop，累加得到端到端时延。</p>
<p>Dend-end=N（Dproc+Dtrans+Dprop）</p>
<p>该时延忽略了处理时延与传播时延。弱化了排队时延。</p>
<h3 id="Traceroute"><a href="#Traceroute" class="headerlink" title="Traceroute"></a>Traceroute</h3><p>Traceroute是一个简单的程序，能够在任何因特网主机上运行，当用户制定一个目的主机名字时，源主机的该程序朝着该目的地发送多个特殊的分组。当分组向目的地传送时，通过一系列的路由器，当路由器接收到这些特殊分组之一时，它向源回送一个短报文，包括该路由器的名字和地址。</p>
<p>即Traceroute会向路径上的所有路由器发送分组。它可以重建路径上所采用的路由。</p>
<h3 id="端系统、应用程序和其他时延"><a href="#端系统、应用程序和其他时延" class="headerlink" title="端系统、应用程序和其他时延"></a>端系统、应用程序和其他时延</h3><p>端系统中还存在一些其他重要时延。</p>
<ul>
<li>作为它的协议的一部分，希望向共享媒体（如在Wifi或电缆调制解调器情况下）传输分组的端系统可以有意地延迟它的传输以与其他端系统共享媒体。</li>
</ul>
<h2 id="吞吐量"><a href="#吞吐量" class="headerlink" title="吞吐量"></a>吞吐量</h2><p>考虑从主机A到主机B跨越计算机网络传送一个大文件。在任何时间瞬间的<strong>瞬时吞吐量</strong>是主机B接收该文件的<strong>速率</strong>（bps）。若文件由F比特组成，接收到所有比特用去T秒，则平均吞吐量为F/Tbps。</p>
<p>考虑服务器与客户端的端系统，它们由两条链路和一台路由器相连。考虑从服务器传送一个文件到客户的吞吐量。即令Rs表示服务器与路由器间的链路速率，Rc表示路由器与客户间的链路速率。</p>
<p>则若Rs&gt;Rc，那么路由器将不能以接收比特那样块的速率进行转发比特，即以Rc离开路由器，若依然是Rs的发送速率，那么比特将不断的挤压在路由器中。因此吞吐量是min{Rc,Rs}。即<strong>瓶颈链路</strong>的传输速率。（近似值，未考虑分组层次与协议）。</p>
<p>在今天因特网当中对吞吐量限制因素通常是接入网。并且吞吐量不仅仅取决于瓶颈路径，还取决于<strong>干扰流量</strong>（多个人同时下载占用链路）</p>
<h1 id="协议层次及其服务模型"><a href="#协议层次及其服务模型" class="headerlink" title="协议层次及其服务模型"></a>协议层次及其服务模型</h1><p>进行分层的体系结构，使得实现由层所提供的服务容易改变，只要该层对其上面的层提供相同的服务，并且使用来自下面层次的相同服务，当某层的实现变化时，该系统的其余部分保持不变。</p>
<h2 id="协议分层"><a href="#协议分层" class="headerlink" title="协议分层"></a>协议分层</h2><p>一个协议层能够用软件、硬件或两者的结合来实现</p>
<ul>
<li>HTTP与SMTP等应用层协议几乎总是在端系统中用软件实现的，运输层协议也是如此。</li>
<li>因为物理层和数据链路层负责处理跨越特定链路的通信，它们通常是实现在与给定链路相联系的网络接口卡（WiFi接口卡）。</li>
<li>网络层通常是硬件和软件实现的混合体。</li>
</ul>
<p>一个第n层协议也会分布在构成网络的端系统、分组交换机和其他组件中。</p>
<p>因特网的协议栈由五个层次组成。：物理层、链路层、网络层、运输层、应用层。</p>
<h3 id="优缺点"><a href="#优缺点" class="headerlink" title="优缺点"></a>优缺点</h3><ul>
<li>概念化</li>
<li>结构化</li>
</ul>
<p><strong><em>缺点</em></strong>：</p>
<ul>
<li>一层可能会冗余较低层的功能。</li>
<li>某层的功能可能需要仅在其他某层才出现的信息。违反了层次分离的目标</li>
</ul>
<h3 id="应用层"><a href="#应用层" class="headerlink" title="应用层"></a>应用层</h3><p>应用层是网络应用程序以及它们的应用层协议存留的地方。一个端系统中的应用程序使用协议与另一个端系统中的应用程序交换信息的分组，将这种信息分组称为<strong>报文</strong>。</p>
<h3 id="运输层"><a href="#运输层" class="headerlink" title="运输层"></a>运输层</h3><p>运输层在应用程序的端点间传送应用层的报文。有TCP与UDP协议。该层的分组称为<strong>报文段</strong></p>
<p>TCP向他的应用程序提供了面向连接的服务，包括了应用层报文向目的地确保传递和流量控制。TCP将长报文划分为短报文，并提供拥塞控制机制，当网络拥塞时，抑制传输速率</p>
<p>UDP向应用程序提供无连接的服务。</p>
<h3 id="网络层"><a href="#网络层" class="headerlink" title="网络层"></a>网络层</h3><p>该层的分组称为<strong>数据报</strong>，网络层负责将数据报从一台主机移动到另一台主机。其协议包括IP协议等协议。</p>
<p>IP协议定义了在数据报中的各个字段以及端系统和路由器如何作用于这些字段。IP协议作为粘合剂将因特网连接在一起，因特网的网络层也包括决定路由的路由选择协议。</p>
<h3 id="链路层"><a href="#链路层" class="headerlink" title="链路层"></a>链路层</h3><p>链路层将分组从一个结点（主机或路由器）移动到路径上的下一个结点。链路层的分组称为<strong>帧</strong></p>
<p>由链路层提供的服务取决于应用于该链路的特定链路层协议。某些协议基于链路提供<strong>可靠传递</strong>，从传输结点跨越一条链路到接受结点。但是这不同与TCP的可靠，因为TCP是基于端系统的可靠传输，而这个过程中要经过很多的链路。</p>
<h3 id="物理层"><a href="#物理层" class="headerlink" title="物理层"></a>物理层</h3><p>物理层将帧一个一个比特从一个结点移动到下一个结点，该层协议仍然是链路相关的，并且与该链路的实际传输媒体相关。</p>
<h2 id="封装"><a href="#封装" class="headerlink" title="封装"></a>封装</h2><ul>
<li>在发送主机端，一个应用层报文被传输给运输层</li>
<li>运输层收到报文并附上附加信息（运输层的首部信息），应用层报文与运输层首部信息构成了运输层报文段</li>
<li>网路层增加网络层首部信息，产生了网络层数据报</li>
<li>链路层增加链路层首部信息，创建链路层帧</li>
<li>因此，每一层都具有两种类型的字段：首部字段和有效载荷字段。</li>
</ul>
<h1 id="面对攻击的网络"><a href="#面对攻击的网络" class="headerlink" title="面对攻击的网络"></a>面对攻击的网络</h1><h2 id="能够经因特网将有害程序放入计算机"><a href="#能够经因特网将有害程序放入计算机" class="headerlink" title="能够经因特网将有害程序放入计算机"></a>能够经因特网将有害程序放入计算机</h2><h2 id="能够攻击服务器和网络基础设施"><a href="#能够攻击服务器和网络基础设施" class="headerlink" title="能够攻击服务器和网络基础设施"></a>能够攻击服务器和网络基础设施</h2><h2 id="能够嗅探分组"><a href="#能够嗅探分组" class="headerlink" title="能够嗅探分组"></a>能够嗅探分组</h2><h2 id="能够伪装成你信任的人"><a href="#能够伪装成你信任的人" class="headerlink" title="能够伪装成你信任的人"></a>能够伪装成你信任的人</h2><h1 id="因特网最新发展"><a href="#因特网最新发展" class="headerlink" title="因特网最新发展"></a>因特网最新发展</h1><ul>
<li>家庭宽带网接入的积极发展</li>
<li>高速公共WiFi和4G蜂窝电话网的中速因特网接入越来越普及</li>
<li>在线服务上如Google在因特网上部署了自己的广泛的专用网络。因此谷歌几乎可以立即提供搜索结果</li>
<li>许多公司在<strong>云</strong>上运行他们的应用，为应用提供可扩展的计算和存储环境，也为应用提供高性能专用网络的隐含访问。</li>
</ul>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ol>
<li></li>
</ol>

          
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
    </footer>
  </div>
  
  
  
  </article>

    
      

  <article class="post post-type-tags" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/07/06/编程语法学习/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Heper">
      <meta itemprop="description" content="To be awesome">
      <meta itemprop="image" content="/images/head.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">

        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/07/06/编程语法学习/" class="post-title-link" itemprop="url">编程语法学习</a>
              
            
          </h1>
        

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              

              
                
              

              <time title="Erstellt: 2019-07-06 16:32:11 / Geändert am: 16:45:48" itemprop="dateCreated datePublished" datetime="2019-07-06T16:32:11+08:00">2019-07-06</time>
            </span>
          
            

            
          

          
            <span id="/2019/07/06/编程语法学习/" class="post-meta-item leancloud_visitors" data-flag-title="编程语法学习">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">Aufrufe: </span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          
            
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="fa fa-comment-o"></i>
    </span>
    
      <span class="post-meta-item-text">Kommentare: </span>
    
  
    <a href="/2019/07/06/编程语法学习/#comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2019/07/06/编程语法学习/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
          <br>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
            <h1 id="编程语法学习"><a href="#编程语法学习" class="headerlink" title="编程语法学习"></a>编程语法学习</h1><h3 id="基本语法"><a href="#基本语法" class="headerlink" title="基本语法"></a>基本语法</h3><p>由表及里，首先学习基本的词汇与语法。</p>
<h3 id="编码实践"><a href="#编码实践" class="headerlink" title="编码实践"></a>编码实践</h3><p>每一门编程语言的学习都会涉及到：</p>
<ul>
<li>运行环境</li>
<li>数据类型（数字、字符串、数组、集合、映射字典等）</li>
<li>表达式</li>
<li>函数</li>
<li>流程控制</li>
<li>类、方法</li>
</ul>
<p>学习一门新的语言时，要利用以前所学习的语言的功底，但是也要保持开放的心态。（<strong>认知心理学</strong>）</p>
<h3 id="技近乎道"><a href="#技近乎道" class="headerlink" title="技近乎道"></a>技近乎道</h3><p>基础语法的学习，能够让你快速上手，应用实践。对技巧和坑的关注会一定程度上拓展知识面。</p>
<p>系统学习，一方面会进一步拓展知识面，另一方面有利于语言知识结构的形成。</p>
<p>任何一门成熟语言，都有其特有的生态。包括框架、扩展包、解决方案、模式、规范等。在时间中可以不断掌握框架等的使用。</p>
<p>在此情况下，还可以继续去学习语言更底层的东西，而不仅仅留在应用层。如Java中的集合类实现的算法与数据结构，JVM如何执行Java代码等。</p>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ol>
<li></li>
</ol>

          
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
    </footer>
  </div>
  
  
  
  </article>

    
      

  <article class="post post-type-tags" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/07/05/Kotlin/Kotlin：StudyResources/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Heper">
      <meta itemprop="description" content="To be awesome">
      <meta itemprop="image" content="/images/head.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">

        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/07/05/Kotlin/Kotlin：StudyResources/" class="post-title-link" itemprop="url">Kotlin：StudyResources</a>
              
            
          </h1>
        

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              

              
                
              

              <time title="Erstellt: 2019-07-05 11:30:42" itemprop="dateCreated datePublished" datetime="2019-07-05T11:30:42+08:00">2019-07-05</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Bearbeitet am</span>
                
                <time title="Geändert am: 2019-07-06 15:30:49" itemprop="dateModified" datetime="2019-07-06T15:30:49+08:00">2019-07-06</time>
              </span>
            
          

          
            <span id="/2019/07/05/Kotlin/Kotlin：StudyResources/" class="post-meta-item leancloud_visitors" data-flag-title="Kotlin：StudyResources">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">Aufrufe: </span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          
            
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="fa fa-comment-o"></i>
    </span>
    
      <span class="post-meta-item-text">Kommentare: </span>
    
  
    <a href="/2019/07/05/Kotlin/Kotlin：StudyResources/#comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2019/07/05/Kotlin/Kotlin：StudyResources/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
          <br>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
            <p>[Kotlin极简教程]</p>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ol>
<li></li>
</ol>

          
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
    </footer>
  </div>
  
  
  
  </article>

    
      

  <article class="post post-type-tags" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/07/05/Kotlin/Kotlin：start/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Heper">
      <meta itemprop="description" content="To be awesome">
      <meta itemprop="image" content="/images/head.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">

        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/07/05/Kotlin/Kotlin：start/" class="post-title-link" itemprop="url">Kotlin：start</a>
              
            
          </h1>
        

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              

              
                
              

              <time title="Erstellt: 2019-07-05 11:30:30" itemprop="dateCreated datePublished" datetime="2019-07-05T11:30:30+08:00">2019-07-05</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Bearbeitet am</span>
                
                <time title="Geändert am: 2019-07-08 15:52:44" itemprop="dateModified" datetime="2019-07-08T15:52:44+08:00">2019-07-08</time>
              </span>
            
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">in</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Kotlin/" itemprop="url" rel="index"><span itemprop="name">Kotlin</span></a></span>

                
                
              
            </span>
          

          
            <span id="/2019/07/05/Kotlin/Kotlin：start/" class="post-meta-item leancloud_visitors" data-flag-title="Kotlin：start">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">Aufrufe: </span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          
            
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="fa fa-comment-o"></i>
    </span>
    
      <span class="post-meta-item-text">Kommentare: </span>
    
  
    <a href="/2019/07/05/Kotlin/Kotlin：start/#comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2019/07/05/Kotlin/Kotlin：start/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
          <br>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
            <h1 id="待整理"><a href="#待整理" class="headerlink" title="待整理"></a>待整理</h1><h1 id="Kotlin语言基础"><a href="#Kotlin语言基础" class="headerlink" title="Kotlin语言基础"></a>Kotlin语言基础</h1><h2 id="包"><a href="#包" class="headerlink" title="包"></a>包</h2><p>Kotlin沿用了Java的package概念，同时做出了扩展。</p>
<p>包的声明位于源文件顶部。目录与包的结构无需匹配，即源代码可以在文件系统的任意位置。</p>
<p>若不顶用</p>
<p>内部可以定义包函数。包函数可以与类在同一个包的命名空间下，在此情况下， 包函数可以直接调用而不需要import</p>
<p>若不在一个包下，则需要import对应的类与函数</p>
<p>声明变量和值</p>
<h2 id="声明变量和值"><a href="#声明变量和值" class="headerlink" title="声明变量和值"></a>声明变量和值</h2><p>kotlin当中一切都是对象。变量可分为：</p>
<ul>
<li><strong>var：</strong> var是一个可变变量，这是一个可以通过重新分配来更改为另一个值的变量。这种声明变量的方式和Java中声明变量的方式一样。</li>
<li><strong>val：</strong> val是一个只读变量，这种声明变量的方式相当于java中的final变量。一个val创建的时候必须初始化，因为以后不能被改变。</li>
</ul>
<h2 id="变量类型推断"><a href="#变量类型推断" class="headerlink" title="变量类型推断"></a>变量类型推断</h2><h3 id="省去变量类型"><a href="#省去变量类型" class="headerlink" title="省去变量类型"></a>省去变量类型</h3><p>Kotlin中大部分情况不需要说明使用对象的类型，由编译器推断出他的类型。当然也可以明确地指出变量的类型。</p>
<h3 id="is进行类型检测"><a href="#is进行类型检测" class="headerlink" title="is进行类型检测"></a>is进行类型检测</h3><p><code>is</code>检测一个表达式是否某类型的一个实例</p>
<p>如果一个不可变的局部变量或属性已经判断出为某类型，那么检测后的分支中可以直接当作该类型使用，无需显式转换：</p>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ol>
<li><a href="https://juejin.im/post/5ccd2dce5188251b984d85e6" target="_blank" rel="noopener">SpringBoot 2.X Kotlin 系列之Hello World</a></li>
</ol>

          
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
    </footer>
  </div>
  
  
  
  </article>

    
      

  <article class="post post-type-tags" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/07/05/系统架构/领域驱动设计：domain/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Heper">
      <meta itemprop="description" content="To be awesome">
      <meta itemprop="image" content="/images/head.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">

        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/07/05/系统架构/领域驱动设计：domain/" class="post-title-link" itemprop="url">领域驱动设计：domain</a>
              
            
          </h1>
        

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              

              
                
              

              <time title="Erstellt: 2019-07-05 09:26:22 / Geändert am: 09:51:43" itemprop="dateCreated datePublished" datetime="2019-07-05T09:26:22+08:00">2019-07-05</time>
            </span>
          
            

            
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">in</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/架构/" itemprop="url" rel="index"><span itemprop="name">架构</span></a></span>

                
                
              
            </span>
          

          
            <span id="/2019/07/05/系统架构/领域驱动设计：domain/" class="post-meta-item leancloud_visitors" data-flag-title="领域驱动设计：domain">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">Aufrufe: </span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          
            
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="fa fa-comment-o"></i>
    </span>
    
      <span class="post-meta-item-text">Kommentare: </span>
    
  
    <a href="/2019/07/05/系统架构/领域驱动设计：domain/#comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2019/07/05/系统架构/领域驱动设计：domain/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
          <br>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
            <h1 id="domain建模示例"><a href="#domain建模示例" class="headerlink" title="domain建模示例"></a>domain建模示例</h1><h1 id="发布帖子"><a href="#发布帖子" class="headerlink" title="发布帖子"></a>发布帖子</h1><h2 id="Round-I"><a href="#Round-I" class="headerlink" title="Round-I"></a>Round-I</h2><h3 id="业务建模"><a href="#业务建模" class="headerlink" title="业务建模"></a>业务建模</h3><p>在大家的常识中，每个人都有自己的观点，并可以发表自己的观点，在社区中便表现为：发布帖子。那么谁发布帖子呢？ 很明显是帖子作者，于是我们便可以得到如下描述：<strong>帖子作者发布帖子</strong>。从上述描述中，我们很容易得到如下几个实体及其行为：帖子作者（PostAuthor）、帖子（Post），而PostAuthor拥有‘发布帖子’的业务行为，我们记着：posting()。</p>
<p>我们再细化现有的模型中的实体。作为实体，必须有一个唯一业务标识，我们为PostAuthor添加一个’作者编号’（authorId），为Post添加一个‘帖子编号’（postId）；PostAuthor可能还存在其他一些属性，我们暂且不管，因为对于我们现在的业务场景无关紧要；再看Post实体，很明显帖子有‘帖子标题’（postTitle）、‘帖子正文’（postContent）、‘帖子发布时间’（postingTime）等等。同时，从业务上要求：帖子发帖时间即为帖子发布动作发生的时间点，帖子的作者是不能为空的，帖子的内容不能为空，帖子的标题可以为空。</p>
<p>​此外，为了减少垃圾帖对社区的负面影响，对于‘帖子内容’强制要求帖子内容长度必须不少于16个汉字，字母和数字等同于汉字处理。</p>
<p>总结可以得到‘发布帖子’场景的业务模型描述：</p>
<ul>
<li><strong>帖子作者发布帖子，帖子标题可以为空，帖子内容不能为空，且不少于16个汉字。</strong> </li>
</ul>
<p>鉴于PostAuthor和Post关系紧密，我们姑且将其和Post放到同一个模块，但是Post看上去并不是PostAuthor的根实体，有点怪怪的感觉，暂且不追究。</p>
<h3 id="业务模型"><a href="#业务模型" class="headerlink" title="业务模型"></a>业务模型</h3><p>综上，于是我们得到如下的业务模型：</p>
<p>　　<img src="assets/849051-20170916213800235-1671481319.png" alt="img"></p>
<h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><h4 id="Post-java"><a href="#Post-java" class="headerlink" title="Post.java"></a>Post.java</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 帖子实体</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> DAOQIDELV</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@CreateDate</span> 2017年9月16日</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Post</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 帖子id</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">long</span> id;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *帖子作者</span></span><br><span class="line"><span class="comment">     */</span>  </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">long</span> authorId;    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 帖子标题</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String title;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 帖子源内容</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String sourceContent;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 发帖时间</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Timestamp postingTime;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Post</span><span class="params">(<span class="keyword">long</span> authorId, String title, String sourceContent)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.setAuthorId(authorId);</span><br><span class="line">        <span class="keyword">this</span>.setTitle(title);</span><br><span class="line">        <span class="keyword">this</span>.setSourceContent(sourceContent);</span><br><span class="line">        <span class="keyword">this</span>.postingTime = <span class="keyword">new</span> Timestamp(System.currentTimeMillis());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> authorId the authorId to set</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAuthorId</span><span class="params">(<span class="keyword">long</span> authorId)</span> </span>&#123;</span><br><span class="line">        Assert.isTrue(authorId &gt; <span class="number">0</span>, <span class="string">"Post's authorId must greater than ZERO."</span>);</span><br><span class="line">        <span class="keyword">this</span>.authorId = authorId;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> sourceContent the sourceContent to set</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSourceContent</span><span class="params">(String sourceContent)</span> </span>&#123;</span><br><span class="line">        Assert.isTrue(!StringUtils.isEmpty(sourceContent), <span class="string">"Post's sourceContent must NOT be empty."</span>);</span><br><span class="line">        <span class="keyword">this</span>.sourceContent = sourceContent;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//ignore some setter/getter</span></span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="PostAuthor-java"><a href="#PostAuthor-java" class="headerlink" title="PostAuthor.java"></a>PostAuthor.java</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 帖子作者</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> DAOQIDELV</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@CreateDate</span> 2017年9月16日</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PostAuthor</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">long</span> id;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">PostAuthor</span><span class="params">(<span class="keyword">long</span> id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 发布帖子</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> title</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> sourceContent</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> Post 发布得到的帖子</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Post <span class="title">posting</span><span class="params">(String title, String sourceContent)</span> <span class="keyword">throws</span> BusinessException </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(sourceContent.length() &lt; <span class="number">16</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> BusinessException(ExceptionCode.POST_SOURCE_CONTENT_AT_LEAST_SIXTEEN_WORDS);</span><br><span class="line">        &#125;</span><br><span class="line">        Post post = <span class="keyword">new</span> Post(<span class="keyword">this</span>.id, title, sourceContent);</span><br><span class="line">        <span class="keyword">return</span> post;</span><br><span class="line">    &#125;</span><br><span class="line">        </span><br><span class="line">       <span class="comment">//ignore some setter/getter</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="构造方法"><a href="#构造方法" class="headerlink" title="构造方法"></a>构造方法</h4><p>　　在代码示例中，我们为Post实体提供了一个私有的构造函数，其中只完成了postingTime的初始化，我们的目的是为了限制创建一个空内容的帖子，因为这在实际的业务场景中是不存在的，因此模型也不应当提供这样的构造函数；</p>
<p>　　另外，还提供了一个包含（authorId,title,sourceContent）的public构造函数，从当前的情形来看是够用了，如果后续有业务场景需要更多的属性传入构造函数，则我们可以重载实现，但是通常来讲，构造函数的入参最好不要超过五个，否则不利于代码阅读，当然特殊业务场景下除外；</p>
<p>　　最后，在构造函数中，我们并没有直接使用“this.title = title;”的写法，而是使用了这种写法：”this.setTitle(title);”，好处在于我们<strong>希望Post实体成为一个“自治的实体”，简单来讲就是可以自我检查 / 自我维护的实体</strong>，使用setter的方式，让我们可以再setter方法中加入一些规则判定，使得外部传入的参数满足一定的规格，具体可以参考下一节中的解释。这种处理方式被Martin Fowler称之为“自封装性”，参考了《实现领域驱动设计》P184。</p>
<h4 id="setter方法"><a href="#setter方法" class="headerlink" title="setter方法"></a>setter方法</h4><p>　　接上一节中提到的“自治实体”，我们希望setter方法提供一种校验机制，确保外部传入的参数满足实体的一定规格，也就是具体的业务逻辑。比如说Post实体中的setSourceContent(String sourceContent)方法，业务规则要求：帖子的正文不能为空，因此在Post.setSourceContent(sourceContent)中加入了Assert断言，确保这一规则被强制实现。</p>
<p>　　参考自Eric Evans的《领域驱动设计》P154。</p>
<h4 id="posting方法"><a href="#posting方法" class="headerlink" title="posting方法"></a>posting方法</h4><p>　　PostAuthor实体现在有了一个业务方法：posting()，它接受具体帖子信息属性，最后返回一个Post实体，很明显PostAuthor现在作为一个Post实体的<strong>factory</strong>存在。</p>
<p>　　posting方法对外声明会throw出一个BusinessException异常，BusinessException异常是自定义的业务异常大类，该异常会统一交由框架统一异常处理，这样确保domain领域的干净。posting方法中判定“帖子内容小于16个字”时，便会向上层抛出异常码为2000的BusinessException，</p>
<h2 id="Round-II"><a href="#Round-II" class="headerlink" title="Round-II"></a>Round-II</h2><h3 id="业务建模-1"><a href="#业务建模-1" class="headerlink" title="业务建模"></a>业务建模</h3><p>　　我们继续往下探寻业务实体。在讨论中，我们发现发布帖子时，通常需要选择关联哪些话题，且一次性可以关联多个话题，最多可以关联五个话题，且话题不能重复加入。我们尝试用一句话将上述模型表述出来：</p>
<ul>
<li><strong>帖子可以加入不多于五个话题，且话题不能重复加入。</strong></li>
</ul>
<p>　　这样就引入了一个新的实体：话题（Topic），话题持有唯一业务标识，话题应当拥有这些常见的属性：话题名称（title）、话题简介（description）、话题创建者（authorId）、话题创建时间（creatingTime）等；其中，话题名称、话题内容和话题创建者均不能为空。由于这些属性和‘创建话题’的case相关，在这里我们不做过多讨论。</p>
<p>　　那么Post和Topic的关系是什么呢？肯定不是“聚合”的关系，因为即使Topic消失了，但是Post还在；也不会是“组合”关系，Topic并不是由许多的Post组合而成的；正如业务建模中的描述：Post关联多个话题，所以Post和Topic之间是1：N的关联关系。那么我们是否应当让Post持有多个Topic呢？显然太重了，Topic是一个实体，实体的状态/属性值是会发生改变的，Topic状态发生改变就会引起Post实体内容改变，因此，我们可以有如下两种处理方式：</p>
<ol>
<li>引入一个值对象TopicId，让Post关联多个TopicId，这个值对象只有一个属性值：topicId，表征Topic的唯一标识值；这是《实现领域驱动设计》中的实现方式；</li>
<li>引入一个值对象TopicPost，表征“话题相关的帖子”，这个值对象可以有更多的属性值。</li>
</ol>
<p>　　对比下来，方案2扩展性会更好，且表达能力更强，同时TopicPost这个值对象还可以应用到Topic实体中，在Topic相关的业务case中，会有找到一个Topic下关联的帖子列表的场景，这时候会发现TopicPost便大有用处了。</p>
<p>　　那么TopicPost和Post之间还是关联关系吗？显然不是。一个Post被删除，那么与其相关的TopicPost值对象也就不复存在了，因此Post持有多个TopicPost，他们是组合关系。</p>
<p>　　那么TopicPost是属于Topic模块（module）还是属于Post模块，很简单，它以“Topic”打头，因此我们将TopicPost放入Topic模块中。</p>
<p>　　再来看业务行为，我们将“帖子加入话题”这个业务行为命名为joinTopics(String topics)，字面上‘帖子’是主语，显然joinTopics是Post的业务方法，在这个业务方法中，我们实现业务规则：帖子可以加入的话题数不能多于五个。</p>
<p>　　上述关于TopicPost值对象引入的讨论非常典型，在两个实体存在关联关系时，可以参考建模。</p>
<h3 id="业务模型-1"><a href="#业务模型-1" class="headerlink" title="业务模型"></a>业务模型</h3><p>　　综合上面的讨论，我们得到最新的业务模型如下：</p>
<p><img src="assets/849051-20170917095727297-570959893.png" alt="img"></p>
<h3 id="代码-1"><a href="#代码-1" class="headerlink" title="代码"></a>代码</h3><p>PostAuthor.java没有变化，更改Post.java，新增Topic.java和TopicPost.java：</p>
<h4 id="Post-java-new"><a href="#Post-java-new" class="headerlink" title="Post.java(new)"></a>Post.java(new)</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Post</span> </span>&#123;</span><br><span class="line">      ......  </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 将帖子关联话题 </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> topicIds 话题集合</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">joinTopics</span><span class="params">(String topicIds)</span> <span class="keyword">throws</span> BusinessException</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(StringUtils.isEmpty(topicIds)) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        String[] topicIdArray = topicIds.split(CommonConstants.COMMA);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;topicIdArray.length; i++) &#123;</span><br><span class="line">            TopicPost topicPost = <span class="keyword">new</span> TopicPost(Long.valueOf(topicIdArray[i]), <span class="keyword">this</span>.getId());</span><br><span class="line">            <span class="keyword">this</span>.topics.add(topicPost);</span><br><span class="line">            <span class="keyword">if</span>(topicSize() &gt; MAX_JOINED_TOPICS_NUM) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> BusinessException(ExceptionCode.ONE_POST_MOST_JOIN_INTO_FIVE_TOPICS);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取本帖子加入的话题数，参考jdk collection的api设计</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 本帖子加入的话题数</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">topicSize</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.topics.size();</span><br><span class="line">    &#125;</span><br><span class="line">      ......</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Topic"><a href="#Topic" class="headerlink" title="Topic"></a>Topic</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> DAOQIDELV</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@CreateDate</span> 2017年9月16日</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Topic</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 话题id</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">long</span> id;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 话题标题</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String title;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 话题描述</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String description;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 话题创建时间</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Timestamp createTime;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 话题下的帖子列表</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Set&lt;TopicPost&gt; posts;</span><br><span class="line"></span><br><span class="line">        ......</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="TopicPost"><a href="#TopicPost" class="headerlink" title="TopicPost"></a>TopicPost</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> DAOQIDELV</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@CreateDate</span> 2017年9月16日</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TopicPost</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">long</span> postId;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">long</span> topicId;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">TopicPost</span><span class="params">(<span class="keyword">long</span> topicId, <span class="keyword">long</span> postId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.setPostId(postId);</span><br><span class="line">        <span class="keyword">this</span>.setTopicId(topicId);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object anObject)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span> == anObject) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(anObject <span class="keyword">instanceof</span> TopicPost) &#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="keyword">this</span>.postId == ((TopicPost)anObject).getPostId()</span><br><span class="line">                    &amp;&amp; <span class="keyword">this</span>.topicId == ((TopicPost)anObject).getTopicId()) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;    </span><br><span class="line">    &#125;    </span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Long.hashCode(<span class="keyword">this</span>.postId+<span class="keyword">this</span>.topicId);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="组合关系集合化处理"><a href="#组合关系集合化处理" class="headerlink" title="组合关系集合化处理"></a>组合关系集合化处理</h3><p>　　如前面业务建模分析，Post持有多个TopicPost，他们是组合关系。代码中Post持有一个TopicPost类型的Set，最初这个topics属性没有被初始化，导致在每次用到它的时候都要去判空，代码冗余度高，可读性差，后面参考java集合的api设计，将topics这个Set直接在声明时就完成初始化，后续使用就没有后顾之忧了。这一个模式可以参考Martin Fowler的《重构》P208。</p>
<p>　　‘帖子加入话题’的场景只涉及到了topics集合的元素添加，所以，这里暂且定义了两个api：joinTopics(), topicSize()，至于topics的查询、删除操作在后续的建模场景中会逐一涉及到。</p>
<h3 id="改写TopicPost的equals和hashCode方法"><a href="#改写TopicPost的equals和hashCode方法" class="headerlink" title="改写TopicPost的equals和hashCode方法"></a>改写TopicPost的equals和hashCode方法</h3><p>　　一个帖子不能重复加入某个话题，因此我们使用了HashSet这种数据结构，HashSet中的元素是不能重复的，所以在向HashSet中add元素时，HashSet会判定元素是否相等（== || equals），默认的Object方法equals实现既是比较两个对象是否相等（==），这会带来一个问题：两个在业务上表征同一个帖子加入同一个话题的TopicPost对象会被认为是不相等的两个对象，因此我们需要重写TopicPost的equals和hashCode方法，使之和业务模型保持一致。</p>
<p>　　equals()的实现参考了java.lang.String的写法；hashCode()的重写最佳实践参考了《重构》P185：读取equals()使用的所有字段的hash码，然后对他们进行按位异或操作。hashCode()的目标是保证在对该对象进行集合类api操作时，能保证较好的散列性，因此只要能达到这个目标就行，鉴于TopicPost中equals方法是用到的topicId和postId均为Long型，也可以简单地这么实现：Long.hashCode(this.postId + this.topicId)。</p>
<h2 id="Round-III"><a href="#Round-III" class="headerlink" title="Round-III"></a>Round-III</h2><h3 id="业务建模-2"><a href="#业务建模-2" class="headerlink" title="业务建模"></a>业务建模</h3><p>　　为确保社区帖子的质量，以及满足国家法律法规的要求，我们需要对帖子标题和内容进行敏感词、广告语、色情、暴力等内容过滤，这些内容过滤即需要调用第三方服务完成，又需要经过社区系统自己积累的敏感词和广告词过滤，对于帖子标题和帖子正文，只要其中一项被过滤服务发现异常，则该帖子就需要被列入待审核队列，等待运营人员审核完成后才能对外发布。我们尝试使用一句话来描述上述case：</p>
<ul>
<li>　　<strong>帖子标题和内容通过内容过滤后方能发布，如果未能通过内容过滤，则需要经过运营审核之后才能发布。</strong></li>
</ul>
<p>　　可以看到上面场景中出现了一个新的短语“内容过滤”，它不是一个实体，看上去像是一个业务行为，是对帖子的标题和内容进行内容过滤，那么我们是不是直接放置到Post实体上呢？ 由于这个内容过滤的行为比较复杂，且涉及到第三方过滤服务的调用，且对帖子标题和帖子内容的过滤逻辑类似，因此我们有必要将“内容过滤”从帖子实体中抽离出来，变成一个领域服务，我们将之命名为：ContentFilter。</p>
<p>　　考虑到存在多场景多规则的过滤，且只要一个命中一个过滤规则，就可以认为该帖子审核不通过，因此可以使用‘责任链模式’来设计。关于责任链模式的实现和优缺点这里不再赘述，可参考网上资料，或直接看代码即可。</p>
<p>　　另外，我们发现上面的case描述中，还出现了‘内容过滤未通过’的字样，表明Post需要有一个属性来表征内容过滤的结果，考虑到可见case中存在帖子被用户删除等状态，我们记为“帖子状态”（staus），字典定义为：00 – 已发布；01 – 待运营审核；99 – 已删除。</p>
<p>　　上面虽然已经创建了一个领域服务专门来承担‘内容过滤’的职责，但是这个业务行为仍然应当属于Post实体，因此我们为Post增加一个filt()业务行为，在这个业务行为中，会去调用“过滤标题”（filtTitle()） 和 “过滤正文”（filtMainBody()）l两个业务方法完成。而filtTitle()和filtMainBody()则会将具体的内容过滤工作委托给上面提到的责任链模式实现的领域服务ContentFilter。</p>
<p>　　由于ContentFilter这一领域服务采用责任链模式实现，类较多，如果放置到post module下面，不利于阅读，且考虑到后续的评论等场景可能使用到这个服务，故将其单独建立module，取名为：domain.service.contentfilter。</p>
<h3 id="业务模型-2"><a href="#业务模型-2" class="headerlink" title="业务模型"></a>业务模型</h3><p>　　综上，我们可以得到如下业务模型：</p>
<p> <img src="assets/849051-20170917161428594-1398940496.png" alt="img"></p>
<h3 id="代码-2"><a href="#代码-2" class="headerlink" title="代码"></a>代码</h3><p>Post.java(new)</p>
<p>PostStatus.java</p>
<p>PostMainBodyContentFilterChain.java</p>
<p>PostTitleContentFilterChain.java</p>
<p>ContentFilter.java</p>
<p>ImageContentFilter.java</p>
<p> TextContentFilter.java</p>
<p>LocalTextContentFilter.java</p>
<p>RemoteTextContentFilter.java</p>
<h2 id="Summarize"><a href="#Summarize" class="headerlink" title="Summarize"></a>Summarize</h2><h3 id="最终模型"><a href="#最终模型" class="headerlink" title="最终模型"></a>最终模型</h3><p>汇总上面建模过程中对模型的描述，我们得到如下：</p>
<ul>
<li><strong>帖子作者发布帖子，帖子标题可以为空，帖子内容不能为空，且不少于16个汉字；</strong></li>
<li><strong>帖子可以加入不多于五个话题，且话题不能重复加入；</strong></li>
<li><strong>帖子标题和内容通过内容过滤后方能发布，如果未能通过内容过滤，则需要经过运营审核之后才能发布。</strong></li>
</ul>
<p>业务模型图可以参考Round-III中的模型图。</p>
<h3 id="建模经验"><a href="#建模经验" class="headerlink" title="建模经验"></a>建模经验</h3><h4 id="尝试用一句完整的话说描述业务场景"><a href="#尝试用一句完整的话说描述业务场景" class="headerlink" title="尝试用一句完整的话说描述业务场景"></a>尝试用一句完整的话说描述业务场景</h4><p>　　仔细观察，我们发现最终得到的业务模型描述其实和产品经理的PRD契合度非常高，但是产品经理的PRD描述很多适合缺少主语，或者语言分散，需要我们通过建模，将语言重新组织，找到业务实体，找到业务行为，找到业务规则，并反映在模型上。反过来想，我们的业务模型对于产品经理/业务专家来讲也不会陌生，因为我们都是使用统一的业务模型语言进行描述，大家都能懂才对。</p>
<h4 id="小步快走，逐步迭代"><a href="#小步快走，逐步迭代" class="headerlink" title="小步快走，逐步迭代"></a>小步快走，逐步迭代</h4><p>　　’发布帖子‘这个业务场景我们经历了三轮迭代，最终得到了一个较完整的业务模型，每一轮迭代，我们都将焦点聚集在一个case，落实模型之后，再继续往前推进。文章描述起来比较啰嗦，实际建模过程中，可能很快就能完成三轮迭代，得到较满意的模型，但是实际的建模过程应当是和文章描述一样的。</p>
<h4 id="有用的模式"><a href="#有用的模式" class="headerlink" title="有用的模式"></a>有用的模式</h4><ol>
<li>具有关联关系的实体，可以为这种关联关系引入一个值对象，从而降低实体间的耦合，比如：在Post和Topic之间引入了TopicPost值对象；</li>
<li>实体 / 值对象 之间存在组合 / 聚合关系，在设计对外的api时，可以参考jdk中集合的api设计，达到高内聚的目标，这在《重构》这本书中被称为“封装集合（Encapsulate Collection）”，比如：Post实体中的topics话题集便参考Set对外提供api；</li>
<li>配合第2点的实现，通常需要重写equals()和hashCode()方法，最佳实践可以参考示例代码；</li>
<li>极力推荐使用合适的设计模式，提高代码的扩展性和可维护性，比如：contentFilter领域服务组件便采用了“责任链模式”来实现；</li>
<li>当实体依赖于领域服务时，可以讲领域服务作为实体业务方法的参数传入，尤其是当领域服务被ioc容器管理时。比如：contentFilter领域服务组件作为Post的filt()方法的参数传入。</li>
</ol>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ol>
<li></li>
</ol>

          
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
    </footer>
  </div>
  
  
  
  </article>

    
      

  <article class="post post-type-tags" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/07/05/系统架构/领域驱动设计：概述/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Heper">
      <meta itemprop="description" content="To be awesome">
      <meta itemprop="image" content="/images/head.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">

        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/07/05/系统架构/领域驱动设计：概述/" class="post-title-link" itemprop="url">领域驱动设计：概述</a>
              
            
          </h1>
        

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              

              
                
              

              <time title="Erstellt: 2019-07-05 09:11:31" itemprop="dateCreated datePublished" datetime="2019-07-05T09:11:31+08:00">2019-07-05</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Bearbeitet am</span>
                
                <time title="Geändert am: 2019-07-08 10:54:49" itemprop="dateModified" datetime="2019-07-08T10:54:49+08:00">2019-07-08</time>
              </span>
            
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">in</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/架构/" itemprop="url" rel="index"><span itemprop="name">架构</span></a></span>

                
                
              
            </span>
          

          
            <span id="/2019/07/05/系统架构/领域驱动设计：概述/" class="post-meta-item leancloud_visitors" data-flag-title="领域驱动设计：概述">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">Aufrufe: </span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          
            
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="fa fa-comment-o"></i>
    </span>
    
      <span class="post-meta-item-text">Kommentare: </span>
    
  
    <a href="/2019/07/05/系统架构/领域驱动设计：概述/#comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2019/07/05/系统架构/领域驱动设计：概述/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
          <br>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
            <h1 id="精要"><a href="#精要" class="headerlink" title="精要"></a>精要</h1><h3 id="核心"><a href="#核心" class="headerlink" title="核心"></a>核心</h3><ol>
<li>将所有业务逻辑内聚到业务领域（domain）层，将设计和开发的关注点聚焦到业务领域；</li>
<li>建立通用的‘业务领域语言（Ubiquitous Language）’，Ubiquitous Language是工程师和业务领域专家（可以是产品经理、运营、业务相关人员）的桥梁；</li>
<li>战略上，通‘上下文（Bounded Context）’解耦各个业务系统/组件，通过‘防腐层（Anticorruption layer）’确保自有业务领域不受外界污染，通过‘开放主机服务（Open Host Service）’向外界公开服务；</li>
<li>战术上，将业务对象建模为entity和value object，entity有唯一业务标识且在其生命周期中状态可变，value object与之相反；关联性强的entity和value object聚合成一个Aggregate，每个Aggregate有一个root entity，确保Aggregate内容业务规则和行为的一致性；业务行为尽量建模在entity/ value object 上，当业务行为无法建模到任何业务entity/value object时，可以使用领域服务（domain service），使用factory创建复杂的业务entity，使用repository实现实体的重建和持久化操作；领域相关的通知等可以通过domain event发布出去。</li>
</ol>
<h3 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h3><ul>
<li><strong>Bounded context：边界上下文</strong></li>
</ul>
<p>划分领域边界，边界内领域模型保持一致，强调内聚，并与边界外的领域模型解耦。</p>
<ul>
<li><strong>Entity：领域实体</strong></li>
</ul>
<p>有唯一标识，可变的业务实体对象，它有着自己的生命周期。比如User、帖子等。</p>
<ul>
<li><strong>Value Object：领域值对象</strong></li>
</ul>
<p>没有唯一业务标识，通常依附于其他领域实体，值对象的内容不可变，要么被整体替换。如：用户点赞行为等。</p>
<ul>
<li><strong>Aggregate：聚合</strong></li>
</ul>
<p>是一组业务关联度很强的实体/值对象集合，每个聚合都有一个根实体（Root Entity），通过根实体可以路由到整个聚合。</p>
<ul>
<li><strong>Domain Event：领域事件</strong></li>
</ul>
<p>领域中发生的异步处理事件、异步消息通知等，比如：异步写入的登录历史记录。通常借助消息队列实现。</p>
<ul>
<li><strong>Domain Service：领域服务</strong></li>
</ul>
<p>当某些业务行为无法归类到某一个Entity/Value Object时，我们便可以创建领域服务来完成。比如：账户转账场景，涉及到两个不同的Account实体，再比如社区的敏感词过滤场景，帖子可以用，评论亦可以用，因此可以抽离到ContentFilter中完成。</p>
<ul>
<li><strong>Repository：仓库</strong></li>
</ul>
<p>严格意义上将仓库是基础设施层的东西，但是为了保持领域模型的整体性，我们将仓库的接口定义放到领域中，这样可以在领域中约束实体/值对象的增删改查接口，同时还可以方便地完成仓库的内存形式实现，使得领域模型弱依赖于持久化层。这一点在书中被成为‘依赖倒置’（参考《实现领域驱动设计》P372）。</p>
<ul>
<li><strong>Factory：领域对象工厂</strong></li>
</ul>
<p>用于复杂领域对象的创建/重建。重建是指通过respostory加载持久化对象后，重建领域对象。</p>
<h3 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h3><ul>
<li>业务逻辑内聚到业务领域层，可以更好的保证业务规则的一致性；</li>
<li>软件的可维护性和可扩展性增强，工程师可以聚焦在业务领域层，并致力于业务领域模型的迭代和维护，适应新业务的发展；</li>
<li>软件的可测试性增强，领域层代码不需要借助用户接口层的入口便可以独立测试业务逻辑，通过repository的哑实现可以摆脱对数据持久层的依赖；</li>
<li>软件工程师和业务领域专家（产品经理）使用同一种语言交流，沟通成本降低，提升效率；【这一点在现实中或多或少在使用，但是比较模糊，很多时候大家会用到‘领域’这个词语，但是并不会刻意地坐下来讨论各自领域应当包含哪些实体……这也是大家可以进步的地方。】</li>
</ul>
<h3 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h3><ul>
<li>对工程师有较高的业务建模技能要求，期望他们能从复杂的业务上下文中识别出正确的业务模型，并将各个业务行为归入合适的entity/value object/domain service中；</li>
<li>项目前期需要投入更多的时间进行业务建模，不能快速进入开发阶段；</li>
<li>需要资深的业务领域专家参与进来，否则业务模型的频繁重构（重大改动）会带来额外成本；<br>DDD适用场景</li>
<li>业务逻辑复杂的系统；不太复杂的业务系统没有必要使用DDD，比如内容管理系统，只是对内容进行简单的增删改查；再比如渠道接入层系统，只是做请求的转发和翻译，没有核心业务逻辑，就没有必要使用DDD。</li>
<li>有资深的业务领域专家支持，需要有一个很懂业务的人，在业务上提供指导性的意见；</li>
<li>工程师都认可DDD设计思路，并积极主动地探讨和迭代，将业务模型日趋完善；</li>
<li>项目工期压力可以接受。</li>
</ul>
<h1 id="架构风格"><a href="#架构风格" class="headerlink" title="架构风格"></a>架构风格</h1><p>针对DDD的架构，《实现领域驱动设计》提到了几种架构风格：六边形架构、REST架构、CQRS、事件驱动等。在实际使用中，落地的架构并非是纯粹其中的一种，而很有可能户将上述几种架构风格结合起来实现。</p>
<h2 id="分层架构"><a href="#分层架构" class="headerlink" title="分层架构"></a>分层架构</h2><ul>
<li>将领域逻辑和展示逻辑及基础设施分离出来</li>
<li>领域逻辑依赖基础设施</li>
<li>代价：领域层到展示层的数据转化</li>
</ul>
<p><img src="assets/1562554034673.png" alt="1562554034673"></p>
<h2 id="六边形架构（端口和适配器）"><a href="#六边形架构（端口和适配器）" class="headerlink" title="六边形架构（端口和适配器）"></a>六边形架构（端口和适配器）</h2><p>所谓的六边形架构，其实是分层架构的扩展，原来的分层架构通常是上下分层的，比如常见的MVC模式，上层是对外的服务接口，下层是对接存储层或者是集成第三方服务，中层是业务逻辑层。</p>
<p>我们跳出分层的概念，会发现上面层和下面层其实都是端口+适配器的实现，上面层开放http/tcp端口，采用rest/soap/mq协议等对外提供服务，同时提供对应协议的适配器；下层也是端口+适配器，只不过应用程序这时候变成了调用者，第三方服务或者存储层提供端口和服务，应用程序本身实现适配功能。</p>
<p>基于上述思考，将分层接口中的上层和下层统一起来就变成了六边形架构，基于端口和适配器的实现，示意图如下：</p>
<p><img src="assets/849051-20170909215810960-1659673125.png" alt="img"></p>
<p><em>*上图来源于《实现领域驱动设计》的P111</em></p>
<p>我认为六边形架构并非创造一种新的架构风格，只是将原来的分层架构风格重新解读，使得架构更加简洁通用。同时，在DDD的设计思想下，六边形架构风格，让领域模型处于架构的核心区域，让开发人员将焦点聚集到领域。<strong>DDD和六边形架构是天然契合的，是DDD的首选架构。</strong></p>
<h2 id="REST"><a href="#REST" class="headerlink" title="REST"></a>REST</h2><p>REST——即Representational State Transfer的缩写，翻译过来是”表现层状态转化”。参考至：<a href="http://www.ruanyifeng.com/blog/2011/09/restful" target="_blank" rel="noopener">理解RESTful架构</a>。</p>
<p>RESTful风格的架构将‘资源’放在第一位，每个‘资源’都有一个URI与之对应，可以将‘资源’看着是ddd中的实体；RESTful采用具有自描述功能的消息实现无状态通信，提高系统的可用性；至于‘资源’的哪些属性可以公开出去，针对‘资源’的操作，RESTful使用HTTP协议的已有方法来实现：GET、PUT、POST和DELETE。</p>
<p>在DDD的实现中，我们可以将对外的服务设计为RESTful风格的服务，将实体/值对象/领域服务作为’资源’对外提供增删改查服务。但是并不建议直接将实体暴露在外，一来实体的某些隐私属性并不能对外暴露，二来某些资源获取场景并不是一个实体就能满足的，因此我们在实际实践过程中，在领域模型上增加了dto这样一个角色，dto可以组合多个实体/值对象的资源对外暴露。</p>
<h2 id="CQRS"><a href="#CQRS" class="headerlink" title="CQRS"></a>CQRS</h2><p>CQRS——Cammand-Query Responsibility Segregation的缩写。翻译过来就是“<a href="http://www.udidahan.com/2009/12/09/clarified-cqrs/" target="_blank" rel="noopener">命令与查询职责分离</a>”。</p>
<p>简而言之，CQRS就是平常大家在讲的读写分离，通常读写分离的目的是为了提高查询性能，同时达到读/写的解耦。让DDD和CQRS结合，我们可以分别对读和写建模，查询模型通常是一种非规范化数据模型，它并不反映领域行为，只是用于数据显示；命令模型执行领域行为，且在领域行为执行完成后，想办法通知到查询模型。</p>
<p>那么命令模型如何通知到查询模型呢？ 如果查询模型和领域模型共享数据源，则可以省却这一步；如果没有共用数据源，则可以借助于‘消息模式’（Messaging Patterns）通知到查询模型，从而达到最终一致性（Eventual Consistency）。</p>
<p>Martin在blog中指出：</p>
<ul>
<li>CQRS适用于极少数复杂的业务领域，如果不是很适合反而会增加复杂度；</li>
<li>另一个适用场景为获取高性能的服务。</li>
</ul>
<p><img src="assets/849051-20170910154357522-1724095095.png" alt="img"></p>
<p>　　　　<em>图片来源于Martin Fowler的blog，图中表述的查询模型和命令模型共用数据源。</em></p>
<p>关于CQRS的讨论可以参考Martin大叔的blog：<a href="https://martinfowler.com/bliki/CQRS.html" target="_blank" rel="noopener">CQRS</a>，以及：<a href="http://codebetter.com/gregyoung/2010/02/16/cqrs-task-based-uis-event-sourcing-agh/" target="_blank" rel="noopener">CQRS, Task Based UIs, Event Sourcing agh!</a></p>
<h2 id="事件溯源"><a href="#事件溯源" class="headerlink" title="事件溯源"></a>事件溯源</h2><ul>
<li>将持久化逻辑彻底从领域模型中分离出去</li>
<li>只持久化业务中发生过什么，不持久化当前状态。当前状态通过回溯所有事件计算出来</li>
<li>业务事件顺序存储，不会更新，写入效率极高</li>
<li>代价：更强的针对事件建模能力，事件回溯机制</li>
</ul>
<p><img src="assets/1562554210896.png" alt="1562554210896"></p>
<h2 id="LMAX-architecture"><a href="#LMAX-architecture" class="headerlink" title="LMAX architecture"></a>LMAX architecture</h2><ul>
<li>将IO和并发从领域模型中分离出去</li>
<li>单线程，异步IO，全内存操作，性能极高</li>
<li>代价：异步IO，无事务回滚等</li>
</ul>
<p><img src="assets/1562554245897.png" alt="1562554245897"></p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><ul>
<li><p>端口适配器架构</p>
<ul>
<li>总是采用，投入很小，却能产出干净的易于测试的领域模型，优于分层架构</li>
</ul>
</li>
<li><p>CQRS</p>
<ul>
<li>一般都可以采用，从共享数据库做起，不急着做分离的查询存储</li>
</ul>
</li>
<li><p>事件溯源</p>
<ul>
<li>一般都不需要用，写入性能要求高，有重播需求时使用</li>
</ul>
</li>
<li><p>LMAX架构</p>
<ul>
<li>一般都不需要用，需要超高性能时采用</li>
</ul>
</li>
</ul>
<h1 id="设计思路"><a href="#设计思路" class="headerlink" title="设计思路"></a>设计思路</h1><h2 id="从责任出发去分析设计"><a href="#从责任出发去分析设计" class="headerlink" title="从责任出发去分析设计"></a>从责任出发去分析设计</h2><ul>
<li><p>DDD从战略设计到战术设计，从子领域、限界上下文到值对象，都是从责任分析出发的，而不是从数据出发的</p>
</li>
<li><p>数据是为了行为服务的，行为是为了完成责任。责任包括</p>
<ul>
<li>内部功能</li>
<li>协调</li>
<li>持有数据</li>
<li>等</li>
</ul>
</li>
<li><p>好的责任分配，能够形成好的依赖关系</p>
</li>
</ul>
<h3 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h3><p><img src="assets/1562554487757.png" alt="1562554487757"></p>
<h1 id="架构实例"><a href="#架构实例" class="headerlink" title="架构实例"></a>架构实例</h1><p>结合最近在重构的社区服务系统（COMMUNITY），尝试使用上述的指导思想和架构风格，完成一次架构设计尝试，并详述如下：</p>
<h2 id="架构图"><a href="#架构图" class="headerlink" title="架构图"></a>架构图</h2><p><img src="assets/849051-20170910175342226-1144290184.png" alt="img"></p>
<h2 id="架构详述"><a href="#架构详述" class="headerlink" title="架构详述"></a>架构详述</h2><p>COMMUNITY系统架构整合了六边形架构、RESTful架构风格、CQRS架构风格三种架构风格，并遵循经典的分层架构思想。</p>
<p>1、在遵循分层架构思想的基础上，引入了六边形架构风格，对内对外均通过适配器+端口的方式呈现：</p>
<ul>
<li>面向用户侧，提供http端口，并使用SpringMVC框架的RequestMapping、Controller等组件实现对http 请求的解析，转化为Application层可识别的业务dto对象，这里的Controller+RequestMapping便起着适配器的作用；</li>
<li>面向第三方服务，通过httpclient和tcpclient的适配，可以对接多种协议的第三方服务端口；</li>
<li>面向存储层，通过mongoclient的适配，访问mongodb；通过mybatis的适配，访问oracle；通过redisclient的适配，访问redis；</li>
<li>面向消息中间件，通过mqclient的适配，方为rabbitMQ；</li>
</ul>
<p>2、实现了RESTful架构风格，通过RESTful风格的接口契约对外提供主机开放服务。借助SpringMVC实现。</p>
<p>3、实现了CQRS架构风格：</p>
<ul>
<li>orcale作为命令模型存储存在，并配以Transaction事务管理。主要存储帖子、评论、话题、圈子、关注等实体信息；</li>
<li>Mongodb作为查询模型存储存在，存储个人动态、社区动态等非结构化数据；</li>
<li>redis同样作为查询模型存储存在，存储用户个人信息、热门评论、热门帖子、热门话题、用户点赞信息等；</li>
<li>Application层分为QueryService和CommandService两大类应用服务，分别组合查询模型和命令模型；</li>
<li>使用rabbitMQ作为消息中间件，CommandService在完成命令模型的维护后，生产事件消息写入rabbitMQ，QueryService作为消费者从rabbitMQ读取事件消息，更新查询模型；</li>
<li>查询模型和命令模型极其对应的application service可以独立部署，独立扩展。</li>
</ul>
<p>4、遵循基本的分层架构风格。</p>
<ul>
<li>User Interface —— 用户接口层。对外提供各种协议形式的服务，并提供Validation参数校验，authenticate权限认证，业务实体组装器Assembler等。图中<strong>标绿</strong>组件。</li>
<li>Application —— 应用服务层。组合多个业务实体、基础设施层的各种组件完成业务服务。图中<strong>标黄</strong>部分。</li>
<li>Domain —— 业务领域层。DDD概念中的核心业务层，封装所有业务逻辑，包含entity、value object、domain service、domain event等。图中<strong>标蓝</strong>部分。</li>
<li>Infrastructure —— 基础设施层。提供公共组件，如：Logging、Trascation、HttpClient等。图中<strong>标灰</strong>部分。</li>
</ul>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ol>
<li></li>
</ol>

          
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
    </footer>
  </div>
  
  
  
  </article>

    
      

  <article class="post post-type-tags" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/07/04/数据库/Jooq/Jooq：Start/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Heper">
      <meta itemprop="description" content="To be awesome">
      <meta itemprop="image" content="/images/head.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">

        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/07/04/数据库/Jooq/Jooq：Start/" class="post-title-link" itemprop="url">Jooq：Start</a>
              
            
          </h1>
        

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              

              
                
              

              <time title="Erstellt: 2019-07-04 11:12:50 / Geändert am: 19:43:26" itemprop="dateCreated datePublished" datetime="2019-07-04T11:12:50+08:00">2019-07-04</time>
            </span>
          
            

            
          

          
            <span id="/2019/07/04/数据库/Jooq/Jooq：Start/" class="post-meta-item leancloud_visitors" data-flag-title="Jooq：Start">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">Aufrufe: </span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          
            
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="fa fa-comment-o"></i>
    </span>
    
      <span class="post-meta-item-text">Kommentare: </span>
    
  
    <a href="/2019/07/04/数据库/Jooq/Jooq：Start/#comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2019/07/04/数据库/Jooq/Jooq：Start/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
          <br>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
            <h1 id="Jooq"><a href="#Jooq" class="headerlink" title="Jooq"></a>Jooq</h1><h2 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h2><h3 id="创建数据库"><a href="#创建数据库" class="headerlink" title="创建数据库"></a>创建数据库</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">DATABASE `library`;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">USE</span> <span class="string">`library`</span>;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`author`</span> (</span><br><span class="line">  <span class="string">`id`</span> <span class="built_in">int</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`first_name`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`last_name`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>)</span><br><span class="line">);</span><br><span class="line"> </span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`author`</span> (<span class="string">`id`</span>, <span class="string">`first_name`</span>, <span class="string">`last_name`</span>) <span class="keyword">VALUES</span> (<span class="string">'1'</span>, <span class="string">'3'</span>, <span class="string">'zhang'</span>), (<span class="string">'2'</span>, <span class="string">'4'</span>, <span class="string">'li'</span>);</span><br></pre></td></tr></table></figure>

<p><strong><em>sql语句</em></strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> AUTHOR.FIRST_NAME, AUTHOR.LAST_NAME, <span class="keyword">COUNT</span>(*)</span><br><span class="line">    <span class="keyword">FROM</span> AUTHOR</span><br><span class="line">    <span class="keyword">JOIN</span> BOOK <span class="keyword">ON</span> AUTHOR.ID = BOOK.AUTHOR_ID</span><br><span class="line">   <span class="keyword">WHERE</span> BOOK.LANGUAGE = <span class="string">'DE'</span></span><br><span class="line">     <span class="keyword">AND</span> BOOK.PUBLISHED &gt; <span class="built_in">DATE</span> <span class="string">'2008-01-01'</span></span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> AUTHOR.FIRST_NAME, AUTHOR.LAST_NAME</span><br><span class="line">  <span class="keyword">HAVING</span> <span class="keyword">COUNT</span>(*) &gt; <span class="number">5</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> AUTHOR.LAST_NAME <span class="keyword">ASC</span> <span class="keyword">NULLS</span> <span class="keyword">FIRST</span></span><br><span class="line">   <span class="keyword">LIMIT</span> <span class="number">2</span></span><br><span class="line">   <span class="keyword">OFFSET</span> <span class="number">1</span></span><br></pre></td></tr></table></figure>

<p><strong><em>Java</em></strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">create.select(AUTHOR.FIRST_NAME, AUTHOR.LAST_NAME, count())</span><br><span class="line">      .from(AUTHOR)</span><br><span class="line">      .join(BOOK).on(AUTHOR.ID.equal(BOOK.AUTHOR_ID))</span><br><span class="line">      .where(BOOK.LANGUAGE.eq(<span class="string">"DE"</span>))</span><br><span class="line">      .and(BOOK.PUBLISHED.gt(date(<span class="string">"2008-01-01"</span>)))</span><br><span class="line">      .groupBy(AUTHOR.FIRST_NAME, AUTHOR.LAST_NAME)</span><br><span class="line">      .having(count().gt(<span class="number">5</span>))</span><br><span class="line">      .orderBy(AUTHOR.LAST_NAME.asc().nullsFirst())</span><br><span class="line">      .limit(<span class="number">2</span>)</span><br><span class="line">      .offset(<span class="number">1</span>)</span><br></pre></td></tr></table></figure>

<h3 id="映射"><a href="#映射" class="headerlink" title="映射"></a>映射</h3><p>这里，要使用jOOQ的命令行工具生成映射到author表的Java类。</p>
<p>代码生成的最简单的方法是将jOOQ的3个jar文件和MySQL Connector jar文件复制到一个临时目录（本示例中目录是test-generated）， 然后创建一个如下所示的library.xml（名字随意修改）：</p>
<p>目录结构：</p>
<p><img src="assets/1562227671175.png" alt="1562227671175"></p>
<p>library.xml配置文件内容：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span> <span class="attr">xmlns</span>=<span class="string">"http://www.jooq.org/xsd/jooq-codegen-3.9.2.xsd"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Configure the database connection here --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">jdbc</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">driver</span>&gt;</span>com.mysql.jdbc.Driver<span class="tag">&lt;/<span class="name">driver</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 数据库url --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url</span>&gt;</span>jdbc:mysql://localhost:3306/library?useUnicode=true&amp;amp;characterEncoding=UTF-8<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 数据库账号 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">user</span>&gt;</span>root<span class="tag">&lt;/<span class="name">user</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 数据库账号密码 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">password</span>&gt;</span>root<span class="tag">&lt;/<span class="name">password</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">jdbc</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">generator</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- The default code generator. You can override this one, to generate your own code style.</span></span><br><span class="line"><span class="comment">             Supported generators:</span></span><br><span class="line"><span class="comment">             - org.jooq.util.JavaGenerator</span></span><br><span class="line"><span class="comment">             - org.jooq.util.ScalaGenerator</span></span><br><span class="line"><span class="comment">             Defaults to org.jooq.util.JavaGenerator --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>org.jooq.util.JavaGenerator<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">        <span class="tag">&lt;<span class="name">database</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- The database type. The format here is:</span></span><br><span class="line"><span class="comment">                 org.util.[database].[database]Database --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">name</span>&gt;</span>org.jooq.util.mysql.MySQLDatabase<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">            <span class="comment">&lt;!-- The database schema (or in the absence of schema support, in your RDBMS this</span></span><br><span class="line"><span class="comment">                 can be the owner, user, database name) to be generated --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">inputSchema</span>&gt;</span>library<span class="tag">&lt;/<span class="name">inputSchema</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">            <span class="comment">&lt;!-- All elements that are generated from your schema</span></span><br><span class="line"><span class="comment">                 (A Java regular expression. Use the pipe to separate several expressions)</span></span><br><span class="line"><span class="comment">                 Watch out for case-sensitivity. Depending on your database, this might be important! --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">includes</span>&gt;</span>.*<span class="tag">&lt;/<span class="name">includes</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">            <span class="comment">&lt;!-- All elements that are excluded from your schema</span></span><br><span class="line"><span class="comment">                 (A Java regular expression. Use the pipe to separate several expressions).</span></span><br><span class="line"><span class="comment">                 Excludes match before includes, i.e. excludes have a higher priority --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">excludes</span>&gt;</span><span class="tag">&lt;/<span class="name">excludes</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">database</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">        <span class="tag">&lt;<span class="name">target</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- The destination package of your generated classes (within the destination directory) --&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 生成的包名，生成的类在此包下 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">packageName</span>&gt;</span>test.generated<span class="tag">&lt;/<span class="name">packageName</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">            <span class="comment">&lt;!-- The destination directory of your generated classes. Using Maven directory layout here --&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 输出的目录 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">directory</span>&gt;</span>J:\IDEA_Work_Space\maven_jooq_demo\src\main\java<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">target</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">generator</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>cd到目录下</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -classpath jooq-3.9.5.jar;jooq-meta-3.9.5.jar;jooq-codegen-3.9.5.jar;mysql-connector-java-5.1.41.jar; org.jooq.util.GenerationTool library.xml</span><br></pre></td></tr></table></figure>

<h3 id="连接数据库"><a href="#连接数据库" class="headerlink" title="连接数据库"></a>连接数据库</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jooq.cn;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.jooq.DSLContext;</span><br><span class="line"><span class="keyword">import</span> org.jooq.Record;</span><br><span class="line"><span class="keyword">import</span> org.jooq.Result;</span><br><span class="line"><span class="keyword">import</span> org.jooq.SQLDialect;</span><br><span class="line"><span class="keyword">import</span> org.jooq.impl.DSL;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.sql.Connection;</span><br><span class="line"><span class="keyword">import</span> java.sql.DriverManager;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> test.generated.tables.Author.AUTHOR;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">        <span class="comment">//用户名</span></span><br><span class="line">        String userName = <span class="string">"root"</span>;</span><br><span class="line">        <span class="comment">//密码</span></span><br><span class="line">        String password = <span class="string">"root"</span>;</span><br><span class="line">        <span class="comment">//mysql链接url</span></span><br><span class="line">        String url = <span class="string">"jdbc:mysql://localhost:3306/library"</span>;</span><br><span class="line">        Connection conn;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">             <span class="comment">//这是JDBC Mysql连接</span></span><br><span class="line">             conn = DriverManager.getConnection(url, userName, password); </span><br><span class="line">             <span class="comment">//基于JOOQ实现的简单查询</span></span><br><span class="line">             <span class="comment">//传入Connection连接对象、数据方言得到一个DSLContext的实例，然后使用DSL对象查询得到一个Result对象。</span></span><br><span class="line">            DSLContext using = DSL.using(conn, SQLDialect.MYSQL);</span><br><span class="line">            Result&lt;Record&gt; fetch = using.select().from(AUTHOR).fetch();</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">            <span class="comment">//for循环输出结果</span></span><br><span class="line">            <span class="keyword">for</span> (Record record : fetch) &#123;</span><br><span class="line">                Integer id = record.getValue(AUTHOR.ID);</span><br><span class="line">                String firstName = record.getValue(AUTHOR.FIRST_NAME);</span><br><span class="line">                String lastName = record.getValue(AUTHOR.LAST_NAME);</span><br><span class="line">                <span class="comment">/**</span></span><br><span class="line"><span class="comment">                 * 控制台输出</span></span><br><span class="line"><span class="comment">                 * ID: 1 first name: 3 last name: zhang</span></span><br><span class="line"><span class="comment">                 * ID: 2 first name: 4 last name: li</span></span><br><span class="line"><span class="comment">                 */</span></span><br><span class="line">                System.out.println(<span class="string">"ID:"</span>+id + <span class="string">"firstName"</span>+ firstName + <span class="string">"lastName: "</span> + lastName);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//关闭连接</span></span><br><span class="line">            conn.close();</span><br><span class="line"> </span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="关闭数据库连接"><a href="#关闭数据库连接" class="headerlink" title="关闭数据库连接"></a>关闭数据库连接</h3><p>DSLContext不会主动关闭连接，需要我们手动关闭。</p>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ol>
<li></li>
</ol>

          
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
    </footer>
  </div>
  
  
  
  </article>

    
      

  <article class="post post-type-tags" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/07/04/数据库/Jooq/Jooq：StudyResources/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Heper">
      <meta itemprop="description" content="To be awesome">
      <meta itemprop="image" content="/images/head.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">

        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/07/04/数据库/Jooq/Jooq：StudyResources/" class="post-title-link" itemprop="url">Jooq：StudyResources</a>
              
            
          </h1>
        

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              

              
                
              

              <time title="Erstellt: 2019-07-04 11:12:13 / Geändert am: 16:03:36" itemprop="dateCreated datePublished" datetime="2019-07-04T11:12:13+08:00">2019-07-04</time>
            </span>
          
            

            
          

          
            <span id="/2019/07/04/数据库/Jooq/Jooq：StudyResources/" class="post-meta-item leancloud_visitors" data-flag-title="Jooq：StudyResources">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">Aufrufe: </span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          
            
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="fa fa-comment-o"></i>
    </span>
    
      <span class="post-meta-item-text">Kommentare: </span>
    
  
    <a href="/2019/07/04/数据库/Jooq/Jooq：StudyResources/#comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2019/07/04/数据库/Jooq/Jooq：StudyResources/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
          <br>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
            <h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ol>
<li><a href="https://blog.csdn.net/weixin_42405670/article/details/89467036" target="_blank" rel="noopener">初步了解JOOQ并实现简单 - - - CRUD（一）</a></li>
</ol>

          
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
    </footer>
  </div>
  
  
  
  </article>

    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/4/"><i class="fa fa-angle-left" aria-label="Vorherige Seite"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><span class="page-number current">5</span><a class="page-number" href="/page/6/">6</a><span class="space">&hellip;</span><a class="page-number" href="/page/22/">22</a><a class="extend next" rel="next" href="/page/6/"><i class="fa fa-angle-right" aria-label="Nächste Seite"></i></a>
  </nav>


          </div>
          

        </div>
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      <div class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">

          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image"
      src="/images/head.jpg"
      alt="Heper">
  <p class="site-author-name" itemprop="name">Heper</p>
  <div class="site-description motion-element" itemprop="description">To be awesome</div>
</div>
  <nav class="site-state motion-element">
      <div class="site-state-item site-state-posts">
        
          <a href="/archives/">
        
          <span class="site-state-item-count">219</span>
          <span class="site-state-item-name">Artikel</span>
        </a>
      </div>
    
      
      
      <div class="site-state-item site-state-categories">
        
        
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
        <span class="site-state-item-count">20</span>
        <span class="site-state-item-name">Kategorien</span>
        
      </div>
    
      
      
      <div class="site-state-item site-state-tags">
        
        
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
        <span class="site-state-item-count">37</span>
        <span class="site-state-item-name">schlagwörter</span>
        
      </div>
    
  </nav>



        </div>
      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Heper</span>
</div>
  <div class="powered-by">Erstellt mit  <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> v3.9.0</div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">Design – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> v7.2.0</div>

        








        
      </div>
    </footer>
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
      </div>

    

  </div>

  
  <script src="/lib/jquery/index.js?v=3.4.1"></script>
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  <script src="/js/utils.js?v=7.2.0"></script>
  <script src="/js/motion.js?v=7.2.0"></script>

  
  <script src="/js/affix.js?v=7.2.0"></script>
  <script src="/js/schemes/pisces.js?v=7.2.0"></script>



  

  <script src="/js/next-boot.js?v=7.2.0"></script>

  

  

  


  











  
  <script>
    function showTime(Counter) {
      var entries = [];
      var $visitors = $('.leancloud_visitors');

      $visitors.each(function() {
        entries.push( $(this).attr('id').trim() );
      });

      Counter('get', '/classes/Counter', { where: JSON.stringify({ url: { '$in': entries } }) })
        .done(function({ results }) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.url;
            var time = item.time;
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for (var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if (countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function ({ responseJSON }) {
          console.log(`LeanCloud Counter Error: ${responseJSON.code} ${responseJSON.error}`);
        });
    }
    

    $(function() {
      $.get('https://app-router.leancloud.cn/2/route?appId=' + 'rNE6CB58iechI12zCD4oeVtM-gzGzoHsz')
        .done(function({ api_server }) {
          var Counter = function(method, url, data) {
            return $.ajax({
              method: method,
              url: `https://${api_server}/1.1${url}`,
              headers: {
                'X-LC-Id': 'rNE6CB58iechI12zCD4oeVtM-gzGzoHsz',
                'X-LC-Key': 'uTVcNIWdMCGpicrhTKygpKXi',
                'Content-Type': 'application/json',
              },
              data: data
            });
          };
            if ($('.post-title-link').length >= 1) {
              showTime(Counter);
            }
          
        });
    });
  </script>












  
<link rel="stylesheet" href="/lib/algolia-instant-search/instantsearch.min.css">
<script src="/lib/algolia-instant-search/instantsearch.min.js"></script>


<script src="/js/algolia-search.js?v=7.2.0"></script>














    
<script src="//unpkg.com/valine/dist/Valine.min.js"></script>

<script>
  var GUEST = ['nick', 'mail', 'link'];
  var guest = 'nick,mail,link';
  guest = guest.split(',').filter(function(item) {
    return GUEST.indexOf(item) > -1;
  });
  new Valine({
    el: '#comments',
    verify: false,
    notify: false,
    appId: 'rNE6CB58iechI12zCD4oeVtM-gzGzoHsz',
    appKey: 'uTVcNIWdMCGpicrhTKygpKXi',
    placeholder: 'Just go go',
    avatar: 'mm',
    meta: guest,
    pageSize: '10' || 10,
    visitor: false,
    lang: 'zh-cn' || 'zh-cn'
  });
</script>


</body>
</html>
